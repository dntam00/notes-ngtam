<html>

<head>
  <title>TrÃ¬nh biÃªn dá»‹ch | Tam's Blog</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Tam's Blog</span></a>
  </div>
  <div class="container">
    <div class="main">
      <p><a href="/">&lt;- Quay vá» trang chá»§</a></p>
      <h1>TrÃ¬nh biÃªn dá»‹ch</h1>
      <p>Sá»­ dá»¥ng Java nhiá»u nÄƒm rá»“i nhÆ°ng mÃ¬nh chÆ°a cÃ³ cÆ¡ há»™i tÃ¬m hiá»ƒu nhiá»u vá» <code>JVM</code>, nÃ³ nhÆ° má»™t chiáº¿c há»™p kÃ­n Ä‘áº§y bÃ­ áº©n vÃ  Ä‘Ã¡ng sá»£, nhÆ° ai Ä‘Ã³ Ä‘Ã£ tá»«ng nÃ³i má»™t trong nhá»¯ng lÃ½ do mÃ¬nh sá»£ cÃ¡i má»™t cÃ¡i gÃ¬ Ä‘Ã³ lÃ  do mÃ¬nh chÆ°a hiá»ƒu rÃµ vá» nÃ³, nÃªn Ä‘á»ƒ bá»›t sá»£ hÆ¡n thÃ¬ mÃ¬nh báº¯t Ä‘áº§u cÃ´ng cuá»™c xoÃ¡ mÃ¹ JVM.</p>
<p>Äá»ƒ tÃ¬m kiáº¿m nhá»¯ng máº£nh chÃ¬a khoÃ¡ Ä‘áº§u tiÃªn trong hÃ nh trÃ¬nh má»Ÿ khoÃ¡ chiáº¿c há»™p nÃ y (hy vá»ng má»Ÿ Ä‘Æ°á»£c :v), mÃ¬nh báº¯t Ä‘áº§u <em>láº¡i</em> vá»›i cÃ¡ch má»™t trÃ¬nh biÃªn dá»‹ch hoáº¡t Ä‘á»™ng. NÃ³i tÃ¬m hiá»ƒu láº¡i lÃ  vÃ¬ há»“i Ä‘áº¡i há»c trÆ°á»ng mÃ¬nh cÃ³ dáº¡y mÃ´n <code>NguyÃªn lÃ½ ngÃ´n ngá»¯ láº­p trÃ¬nh</code> nÃ³i vá» cÃ¡ch má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh (NNLT) hoáº¡t Ä‘á»™ng (mÃ´n nÃ y giá» nghÄ© láº¡i váº«n tháº¥y sá»£ :3). May máº¯n lÃ  sau nhiá»u nÄƒm mÃ¬nh váº«n cÃ²n lÆ°u láº¡i mÃ£ nguá»“n cá»§a bÃ i táº­p lá»›n nÃªn cÃ³ gÃ¬ láº¥y lÃ m vÃ­ dá»¥ trong bÃ i nÃ y luÃ´n. :D</p>
<!-- CÃ³ bao giá» báº¡n tháº¯c máº¯c lÃ m tháº¿ nÃ o mÃ  mÃ¡y tÃ­nh thá»±c thi má»™t chÆ°Æ¡ng trÃ¬nh viáº¿t báº±ng cÃ¡c ngÃ´n ngá»¯ báº­c cao nhÆ° Java, Golang,...? Náº¿u lÃ  láº­p trÃ¬nh viÃªn, cháº¯c cháº¯n ai cÅ©ng biáº¿t Ä‘áº¡i Ã½ lÃ  chÃºng ta sáº½ cáº§n cÃ¡c cÃ´ng cá»¥ nhÆ° trÃ¬nh biÃªn dá»‹ch (`compiler`) hay thÃ´ng dá»‹ch (`interpreter`) tuá»³ vÃ o ngÃ´n ngá»¯. -->
<p>Äá»ƒ má»™t chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ báº­c cao nhÆ° Java, Go,... cháº¡y Ä‘Æ°á»£c trÃªn mÃ¡y tÃ­nh, nÃ³ pháº£i Ä‘Æ°á»£c chuyá»ƒn sang má»™t dáº¡ng mÃ  bá»™ xá»­ lÃ½ cÃ³ thá»ƒ hiá»ƒu vÃ  thá»±c thi. CÃ³ nhiá»u kÄ© thuáº­t Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y:</p>
<ul>
<li><code>BiÃªn dá»‹ch (compilation)</code>: chuyá»ƒn Ä‘á»•i toÃ n bá»™ mÃ£ nguá»“n tá»« má»™t ngÃ´n ngá»¯ nÃ y sang má»™t ngÃ´n ngá»¯ khÃ¡c. MÃ£ cá»§a ngÃ´n ngá»¯ Ä‘Ã­ch khÃ´ng nháº¥t thiáº¿t pháº£i lÃ  mÃ£ mÃ¡y (<code>machine code</code>), tá»©c lÃ  nÃ³ cÃ³ thá»ƒ trá»Ÿ thÃ nh Ä‘áº§u vÃ o cho má»™t trÃ¬nh biÃªn dá»‹ch hay thÃ´ng dá»‹ch khÃ¡c. QuÃ¡ trÃ¬nh nÃ y chá»‰ xáº£y ra 1 láº§n, biÃªn dá»‹ch xong lÃ  ta cÃ³ mÃ£ nguá»“n cá»§a ngÃ´n ngá»¯ Ä‘Ã­ch cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u láº§n. Láº¥y vÃ­ dá»¥ má»™t ngÆ°á»i dá»‹ch giáº£ cÃ³ thá»ƒ dá»‹ch sÃ¡ch 1 láº§n, sau Ä‘Ã³ ngÆ°á»i Ä‘á»c cÃ³ thá»ƒ Ä‘á»c báº£n dá»‹ch nhiá»u láº§n mÃ  khÃ´ng cáº§n lÃ m phiá»n vá»›i dá»‹ch giáº£ ná»¯a :v.</li>
</ul>
<p><img src="img/compiler-model.png" alt="compilers-model" /></p>
<ul>
<li><code>Thuáº§n thÃ´ng dá»‹ch (pure interpretation)</code>: Ä‘á»c vÃ  thá»±c thi trá»±c tiáº¿p tá»«ng dÃ²ng cá»§a mÃ£ nguá»“n. Vá»›i cÃ¡ch lÃ m nÃ y trÃ¬nh thÃ´ng dá»‹ch sáº½ cáº§n láº·p láº¡i cÃ´ng viá»‡c náº¿u má»™t Ä‘oáº¡n code Ä‘Æ°á»£c gá»i nhiá»u láº§n. Äiá»u thÃº vá»‹ á»Ÿ cÃ¡ch mÃ  trÃ¬nh thÃ´ng dá»‹ch thá»±c thi tá»«ng dÃ²ng mÃ£ nguá»“n, trÃ¬nh thÃ´ng dá»‹ch giá»‘ng nhÆ° má»™t trÃ¬nh giáº£ láº­p mÃ¡y (<code>machine emulator</code>), chá»©a má»™t táº­p há»£p cÃ¡c quy trÃ¬nh/chá»‰ dáº«n Ä‘Æ°á»£c chuáº©n bá»‹ sáºµn Ä‘á»ƒ thá»±c thi mÃ£ nguá»“n, nhÃ¬n má»™t cÃ¡ch tá»•ng quÃ¡t hÆ¡n thÃ¬ nÃ³ giá»‘ng nhÆ° bá»™ xá»­ lÃ½ áº£o cho pháº§n má»m váº­y. Láº¥y vÃ­ dá»¥ vá»›i má»™t ngÆ°á»i phiÃªn dá»‹ch viÃªn trong má»™t cuá»™c há»p, há» pháº£i dá»‹ch tá»«ng cÃ¢u cá»§a má»—i bÃªn tham gia, vÃ  cho dÃ¹ng cÃ¡c cÃ¢u nÃ y cÃ³ bá»‹ láº·p láº¡i thÃ¬ há» váº«n pháº£i dá»‹ch.</li>
</ul>
<p><img src="img/pure-interpreter-model.png" alt="pure-interpreter-model" /></p>
<ul>
<li><code>Káº¿t há»£p biÃªn dá»‹ch vÃ  phiÃªn dá»‹ch (hybrid)</code>: káº¿t há»£p cáº£ 2 trÃ¬nh thÃ´ng dá»‹ch vÃ  biÃªn dá»‹ch, trÃ¬nh biÃªn dá»‹ch lÃ m giai Ä‘oáº¡n Ä‘áº§u tiÃªn, biÃªn dá»‹ch ra ngÃ´n ngá»¯ trung gian, sau Ä‘Ã³ trÃ¬nh thÃ´ng dá»‹ch thá»±c thi ngÃ´n ngá»¯ trung gian nÃ y. CÃ³ nhiá»u lÃ½ do Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y, ngÃ´n ngá»¯ trung gian giÃºp tÃ¡ch biá»‡t sá»± phá»¥ thuá»™c vÃ o cáº¥u trÃºc bá»™ xá»­ lÃ½, há»— trá»£ thiáº¿t káº¿ thÃªm cÃ¡c thÃ nh pháº§n Ä‘i kÃ¨m Ä‘á»ƒ tá»‘i Æ°u viá»‡c thá»± thi ngÃ´n ngá»¯ trung gian, quáº£n lÃ½ bá»™ nhá»›,...</li>
</ul>
<p><img src="img/hybrid-model.png" alt="hybrid-model" /></p>
<ul>
<li><code>BiÃªn dá»‹ch Ä‘Ãºng lÃºc (just-in-time compiler)</code>: á»Ÿ pháº§n trÃ¬nh thÃ´ng dá»‹ch mÃ¬nh cÃ³ Ä‘á» cáº­p Ä‘áº¿n má»™t Ä‘iá»ƒm yáº¿u Ä‘Ã³ lÃ  cÃ³ nhiá»u Ä‘oáº¡n code sáº½ Ä‘Æ°á»£c thá»±c thi láº¡i khi Ä‘Æ°á»£c gá»i nhiá»u láº§n, <code>JIT</code> tá»‘i Æ°u pháº§n nÃ y báº±ng cÃ¡ch tÃ¬m nhá»¯ng Ä‘oáº¡n code Ä‘Æ°á»£c thá»±c thi nhiá»u láº§n, thuáº­t ngá»¯ gá»i lÃ  <code>hot code</code> vÃ  biÃªn dá»‹ch ra mÃ£ mÃ¡y.</li>
</ul>
<p><img src="img/just-in-time-model.png" alt="just-in-time-model" /></p>
<p>Giá»›i thiá»‡u qua cÃ¡c kÄ© thuáº­t biÃªn/thÃ´ng dá»‹ch váº­y Ä‘á»§ rá»“i, vÃ o chá»§ Ä‘á» chÃ­nh thÃ´i, bÃ i nÃ y mÃ¬nh sáº½ Ä‘i tÃ¬m hiá»ƒu <em>láº¡i</em> tá»•ng quan cÃ¡c bÆ°á»›c mÃ  má»™t <em><strong>trÃ¬nh biÃªn dá»‹ch</strong></em> cáº§n lÃ m khi xá»­ lÃ½ mÃ£ nguá»“n, nÃ³i tÃ¬m hiá»ƒu láº¡i lÃ  vÃ¬ há»“i Ä‘áº¡i há»c trÆ°á»ng mÃ¬nh cÃ³ dáº¡y mÃ´n <code>NguyÃªn lÃ½ ngÃ´n ngá»¯ láº­p trÃ¬nh</code> trÃ¬nh bÃ y vá» cÃ¡ch má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh (<code>NNLT</code>) hoáº¡t Ä‘á»™ng (mÃ´n nÃ y giá» nghÄ© láº¡i váº«n tháº¥y sá»£ :3). May máº¯n lÃ  sau nhiá»u nÄƒm mÃ¬nh váº«n cÃ²n lÆ°u láº¡i mÃ£ nguá»“n cá»§a bÃ i táº­p lá»›n nÃªn cÃ³ gÃ¬ láº¥y lÃ m vÃ­ dá»¥ trong bÃ i nÃ y luÃ´n. :D</p>
<h2><a href="#trÃ¬nh-biÃªn-dá»‹ch" aria-hidden="true" class="anchor" id="trÃ¬nh-biÃªn-dá»‹ch"></a>TrÃ¬nh biÃªn dá»‹ch</h2>
<p>Äá»ƒ thá»±c thi Ä‘Æ°á»£c cÃ¡c cÃ¢u lá»‡nh trÃªn cpu, báº±ng cÃ¡ch nÃ y hay cÃ¡ch khÃ¡c, táº¥t cáº£ nhá»¯ng gÃ¬ láº­p trÃ¬nh viÃªn viáº¿t ra pháº£i Ä‘Æ°á»£c chuyá»ƒn thÃ nh thá»© mÃ  cpu cÃ³ thá»ƒ hiá»ƒu vÃ  xá»­ lÃ½ Ä‘Æ°á»£c. QuÃ¡ trÃ¬nh nÃ y khi sá»­ dá»¥ng trÃ¬nh biÃªn dá»‹ch thÃ¬ Ä‘Æ°á»£c biá»ƒu diá»…n nhÆ° hÃ¬nh sau:</p>
<p><img src="img/overview-of-compilation.png" alt="overview-of-compilation" /></p>
<h3><a href="#phÃ¢n-tÃ­ch-tá»«-vá»±ng-lexical-analysis)" aria-hidden="true" class="anchor" id="phÃ¢n-tÃ­ch-tá»«-vá»±ng-lexical-analysis)"></a>PhÃ¢n tÃ­ch tá»« vá»±ng (Lexical analysis)</h3>
<p>Láº¥y vÃ­ dá»¥ vá» viá»‡c giao tiáº¿p giá»¯a con ngÆ°á»i, nhá»¯ng gÃ¬ chÃºng ta nÃ³i ra cáº§n cÃ³ Ã½ nghÄ©a thÃ¬ ngÆ°á»i Ä‘á»‘i diá»‡n má»›i hiá»ƒu Ä‘Æ°á»£c, chÃºng Ä‘Æ°á»£c cáº¥u thÃ nh tá»« cÃ¡c bá»™ tá»« vá»±ng Ä‘Ã£ Ä‘Æ°á»£c táº¡o ra, duy trÃ¬ vÃ  phÃ¡t triá»ƒn. Äá»‘i vá»›i NNLT cÅ©ng váº­y, Ä‘á»™i ngÅ© phÃ¡t triá»ƒn ngÃ´n ngá»¯ pháº£i Ä‘á»‹nh nghÄ©a Ä‘Æ°á»£c cÃ¡c tá»« nÃ o cÃ³ Ã½ nghÄ©a Ä‘á»‘i vá»›i NNTL cá»§a há», tá»« nÃ o khÃ´ng, vÃ­ dá»¥ cÃ¹ng má»™t Ã½ nghÄ©a <code>rá»—ng</code> nhÆ°ng Golang vÃ  Java sá»­ dá»¥ng cÃ¡c tá»« khoÃ¡ khÃ¡c nhau, láº§n lÆ°á»£t lÃ  <code>nil</code> vÃ  <code>null</code>.</p>
<p>QuÃ¡ trÃ¬nh tÃ¬m ra cÃ¡c tá»« khoÃ¡ cÃ³ Ã½ nghÄ©a tá»« mÃ£ nguá»“n Ä‘á»ƒ xá»­ lÃ½ Ä‘Æ°á»£c gá»i lÃ  phÃ¢n tÃ­ch tá»« vá»±ng. CÃ´ng cá»¥ phÃ¢n tÃ­ch tá»« vá»±ng sáº½ Ä‘á»c mÃ£ nguá»“n vÃ  láº¥y ra cÃ¡c tá»« khoÃ¡ cáº§n thiáº¿t dá»±a trÃªn bá»™ quy táº¯c Ä‘Æ°á»£c thiáº¿t láº­p sáºµn. QuÃ¡ trÃ¬nh nÃ y cÃ³ thá»ƒ cho ra output nhÆ°:</p>
<ul>
<li>TÃªn hÃ m, tÃªn biáº¿n,...</li>
<li>Tá»« khoÃ¡ cá»§a ngÃ´n ngá»¯.</li>
<li>ToÃ¡n tá»­.</li>
</ul>
<p>Ä‘Æ°á»£c gá»i chung lÃ  <code>tokens</code>.</p>
<p>Má»™t cÃ´ng cá»¥ mÃ¬nh Ä‘Ã£ sá»­ dá»¥ng trong lÃºc lÃ m bÃ i táº­p lá»›n á»Ÿ Ä‘áº¡i há»c lÃ  <a href="https://github.com/antlr/antlr4">ANTLR</a>, má»i ngÆ°á»i cÃ³ thá»ƒ tham kháº£o thÃªm.</p>
<p><img src="img/lexical-analysis.png" alt="lexical-analysis" /></p>
<h3><a href="#phÃ¢n-tÃ­ch-ngá»¯-phÃ¡p-syntax-analysis)" aria-hidden="true" class="anchor" id="phÃ¢n-tÃ­ch-ngá»¯-phÃ¡p-syntax-analysis)"></a>PhÃ¢n tÃ­ch ngá»¯ phÃ¡p (Syntax analysis)</h3>
<p>BÆ°á»›c tiáº¿p theo trong viá»‡c xá»­ lÃ½ mÃ£ nguá»“n lÃ  phÃ¢n tÃ­ch ngá»¯ phÃ¡p.</p>
<p>Tá»« káº¿t quáº£ cá»§a bÆ°á»›c phÃ¢n tÃ­ch tá»« vá»±ng, bá»™ phÃ¢n tÃ­ch ngá»¯ phÃ¡p sáº½ kiá»ƒm tra xem láº­p trÃ¬nh viÃªn cÃ³ sá»­ dá»¥ng cÃ¡c tá»« khoÃ¡ Ä‘Ãºng vá»›i ngá»¯ phÃ¡p Ä‘Ã£ Ä‘Æ°á»£c quy Ä‘á»‹nh hay khÃ´ng. VÃ­ dá»¥ ngá»¯ phÃ¡p tiáº¿ng Viá»‡t cÃ³ cáº¥u trÃºc chá»§ ngá»¯ phÃ¡p chá»§ ngá»¯ rá»“i Ä‘áº¿n Ä‘á»™ng tá»«, thÃ¬ cÃ¡c NNLT cÅ©ng cÃ³ cÃ¡c quy Ä‘á»‹nh cá»§a nÃ³, vá» báº£n cháº¥t Ä‘Ã³ lÃ  sá»± thá»‘ng nháº¥t Ä‘á»ƒ 2 bÃªn cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c nhau.</p>
<p>VÃ­ dá»¥ vá»›i Java, khi viáº¿t cÃ¢u Ä‘iá»u kiá»‡n, chÃºng ta cáº§n má»™t cáº·p dáº¥u ngoáº·c trÃ²n <code>()</code> Ä‘á»ƒ chá»©a Ä‘iá»u kiá»‡n, náº¿u báº¡n quÃªn chÃºng, trÃ¬nh biÃªn dá»‹ch sáº½ bÃ¡o lá»—i cÃº phÃ¡p.</p>
<p>HÃ¬nh dÆ°á»›i má»™t vÃ­ dá»¥ vá» <a href="https://github.com/dntam00/principles-programming-language/blob/master/assignment-1/src/main/bkit/parser/BKIT.g4">bÃ i táº­p lá»›n cá»§a mÃ¬nh</a> Ä‘á»ƒ má»i ngÆ°á»i cÃ³ thá»ƒ hÃ¬nh dung Ä‘Æ°á»£c cÃ¡c quy táº¯c nÃ y Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a ra sao, á»Ÿ ngÃ´n ngá»¯ nÃ y thÃ¬ sau <code>if</code> khÃ´ng cáº§n dáº¥u ngoáº·c :v.</p>
<p><img src="img/antlr4-rules.png" alt="antlr4-if-statement" /></p>
<p>Bá»™ phÃ¢n tÃ­ch ngá»¯ phÃ¡p Ã¡p dá»¥ng quy táº¯c sáº£n xuáº¥t (<code>production rule</code> trong <code>Context-Free Grammar</code>) Ä‘á»ƒ báº¯t Ä‘áº§u xÃ¢y dá»±ng cÃ¢y cÃº phÃ¡p vá»›i quy táº¯c tá»•ng quÃ¡t:</p>
<pre><code class="language-bash">A â†’ Î±
</code></pre>
<ol>
<li>A lÃ  kÃ½ hiá»‡u khÃ´ng káº¿t thÃºc (<code>non-terminal</code>).</li>
<li>Î± lÃ  má»™t chuá»—i gá»“m kÃ½ hiá»‡u káº¿t thÃºc (<code>terminal</code>) vÃ  khÃ´ng káº¿t thÃºc.</li>
</ol>
<p>Táº¥t nhiÃªn gá»i lÃ  khÃ´ng káº¿t thÃºc vÃ¬ ta cÃ³ thá»ƒ phÃ¢n giáº£i kÃ½ hiá»‡u nÃ y thÃ nh má»™t táº­p cÃ¡c kÃ½ hiá»‡u khÃ¡c. Láº¥y vÃ­ dá»¥ mÃ¬nh Ä‘Æ°a á»Ÿ trÃªn, náº¿u báº¡n nhÃ¬n vÃ o quy táº¯c cho cÃ¢u lá»‡nh <code>if</code>, sau tá»« khoÃ¡ <code>THEN</code> lÃ  <code>list_sta</code>, Ã¡p dá»¥ng quy táº¯c sáº£n xuáº¥t, nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c thay tháº¿ báº±ng <code>varaible_dec* statement*</code>, hiá»ƒu lÃ  cÃ¡c khai bÃ¡o biáº¿n, cÃ¡c cÃ¢u lá»‡ch, vÃ  vÃ¬ chÃºng lÃ  kÃ½ hiá»‡u khÃ´ng káº¿t thÃºc, ta sáº½ cáº§n phÃ¢n giáº£i tiáº¿p,...</p>
<p>Sá»­ dá»¥ng quy táº¯c mÃ¬nh vá»«a giá»›i thiá»‡u vÃ  táº­p tokens tá»« bÆ°á»›c phÃ¢n tÃ­ch tá»« vá»±ng, bá»™ phÃ¢n tÃ­ch ngá»¯ phÃ¡p sáº½ thá»±c hiá»‡n kiá»ƒm tra ngá»¯ phÃ¡p, káº¿t quáº£ cá»§a quÃ¡ trÃ¬nh nÃ y lÃ  má»™t cÃ¢y ngá»¯ phÃ¡p Ä‘Æ°á»£c sá»­ dá»¥ng cho cÃ¡c bÆ°á»›c tiáº¿p theo. Náº¿u cÃ³ lá»—i trong quÃ¡ trÃ¬nh táº¡o cÃ¢y, lá»—i sáº½ Ä‘Æ°á»£c tráº£ vá», láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ dá»±a vÃ o lá»—i Ä‘á»ƒ sá»­a mÃ£ nguá»“n cá»§a mÃ¬nh.</p>
<p>HÃ¬nh sau minh hoáº¡ parse-tree cho biá»ƒu thá»©c <code>3 + 5 âˆ— 2</code>.</p>
<p><img src="img/parser-tree-output.png" alt="parser-tree-output" /></p>
<h3><a href="#táº¡o-cÃ¢y-cÃº-phÃ¡p-trá»«u-tÆ°á»£ng-abstract-syntax-tree-generation)" aria-hidden="true" class="anchor" id="táº¡o-cÃ¢y-cÃº-phÃ¡p-trá»«u-tÆ°á»£ng-abstract-syntax-tree-generation)"></a>Táº¡o cÃ¢y cÃº phÃ¡p trá»«u tÆ°á»£ng (Abstract syntax tree generation)</h3>
<p>CÃ¢y cÃº phÃ¡p trá»«u tÆ°á»£ng (<code>Abstract syntax tree - AST</code>) vá» cÆ¡ báº£n cÅ©ng biá»ƒu diá»…n cáº¥u trÃºc cÃº phÃ¡p cá»§a mÃ£ nguá»“n, nhÆ°ng á»Ÿ má»©c trá»«u tÆ°á»£ng hÆ¡n cÃ¢y cÃº phÃ¡p chi tiáº¿t.</p>
<ol>
<li>CÃ¢y phÃ¢n cáº¥p: cÃ³ node gá»‘c vÃ  cÃ¡c node con, má»—i node biá»ƒn diá»…n má»™t cáº¥u trÃºc cá»¥ thá»ƒ cá»§a mÃ£ nguá»“n, vÃ­ dá»¥ khai bÃ¡o biáº¿n, cÃ¢u lá»‡nh láº·p, Ä‘iá»u kiá»‡n, biá»ƒu thá»©c toÃ¡n há»c,...</li>
<li>Má»©c Ä‘á»™ trá»«u trÆ°á»£ng: loáº¡i bá» Ä‘i cÃ¡c chi tiáº¿t ngá»¯ phÃ¡p nhÆ° dáº¥u cháº¥m pháº©y, dáº¥u ngoáº·c,... táº­p trung vÃ o biá»ƒu diá»…n cáº¥u trÃºc cÆ¡ báº£n vÃ  ngá»¯ nghÄ©a cá»§a chÆ°Æ¡ng trÃ¬nh. VÃ­ dá»¥ nhÆ° thay vÃ¬ dÃ¹ng cáº·p dáº¥u ngoáº·c Ä‘Æ¡n Ä‘á»ƒ thá»ƒ hiá»‡n sá»± Æ°u tiÃªn trong cÃ¡c biá»ƒu thá»©c toÃ¡n há»c, AST sá»­ dá»¥ng má»‘i quan há»‡ giá»¯a cÃ¡c node Ä‘á»ƒ biá»ƒu diá»…n.</li>
</ol>
<p><img src="img/ast-abstract.png" alt="ast-abstract" /></p>
<p>Trong thá»±c táº¿, Ä‘á»ƒ táº¡o AST, chÃºng ta cáº§n Ä‘á»‹nh nghÄ©a cÃ¡c <a href="https://github.com/dntam00/principles-programming-language/blob/master/assignment-3/src/main/bkit/utils/AST.py">cáº¥u trÃºc dá»¯ liá»‡u</a> Ä‘á»ƒ biá»ƒu diá»…n cÃ¡c cáº¥u trÃºc cá»§a 1 NNLT, Ä‘oáº¡n code sau biá»ƒu diá»…n 1 class Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin cho má»™t biá»ƒu thá»©c 2 ngÃ´i.</p>
<ol>
<li>ToÃ¡n tá»­.</li>
<li>ToÃ¡n háº¡ng trÃ¡i.</li>
<li>ToÃ¡n háº¡ng pháº£i.</li>
</ol>
<pre><code class="language-python">@dataclass
class BinaryOp(Expr):
    op:str
    left:Expr
    right:Expr

    def __str__(self):
        return &quot;BinaryOp(&quot; + self.op + &quot;,&quot; + str(self.left) + &quot;,&quot; + str(self.right) + &quot;)&quot;

    def accept(self, v, param):
        return v.visitBinaryOp(self, param)
</code></pre>
<p>Äá»ƒ táº¡o AST, cÃ¡c cÃ´ng cá»¥ hiá»‡n táº¡i thÆ°á»ng sá»­ dá»¥ng <a href="https://en.wikipedia.org/wiki/Visitor_pattern">visitor pattern</a> Ä‘á»ƒ duyá»‡t qua cÃ¡c node cá»§a cÃ¢y cÃº phÃ¡p, táº¡i má»—i node sáº½ cÃ³ nghiá»‡p vá»¥ cá»¥ thá»ƒ Ä‘á»ƒ xá»­ lÃ½ vÃ  tráº£ vá» cáº¥u trÃºc biá»ƒu diá»…n trong AST.</p>
<p>Äoáº¡n code sau minh hoáº¡ logic khi duyá»‡t qua má»™t node biá»ƒu diá»…n biá»ƒu thá»©c (báº¡n cÃ³ thá»ƒ xem chi tiáº¿t Ä‘á»‹nh nghÄ©a ngÃ´n ngá»¯ láº­p trÃ¬nh cá»§a bÃ i táº­p lá»›n mÃ¬nh cá»§a mÃ¬nh á»Ÿ <a href="https://github.com/dntam00/principles-programming-language/blob/master/BKIT2009%20Specification-2.2.pdf">BKIT</a>)</p>
<pre><code class="language-python">    def visitExp(self, ctx: BKITParser.ExpContext):
        if ctx.EQUAL_OP_INT():
            return BinaryOp(ctx.EQUAL_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.NOT_EQUAL_OP_INT():
            return BinaryOp(ctx.NOT_EQUAL_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.LESS_OP_INT():
            return BinaryOp(ctx.LESS_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.GREATER_OP_INT():
            return BinaryOp(ctx.GREATER_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.LESS_EQUAL_OP_INT():
            return BinaryOp(ctx.LESS_EQUAL_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.GREATER_EQUAL_OP_INT():
            return BinaryOp(ctx.GREATER_EQUAL_OP_INT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.NOT_EQUAL_OP_FLOAT():
            return BinaryOp(ctx.NOT_EQUAL_OP_FLOAT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.LESS_OP_FLOAT():
            return BinaryOp(ctx.LESS_OP_FLOAT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.GREATER_OP_FLOAT():
            return BinaryOp(ctx.GREATER_OP_FLOAT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.LESS_EQUAL_OP_FLOAT():
            return BinaryOp(ctx.LESS_EQUAL_OP_FLOAT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        elif ctx.GREATER_EQUAL_OP_FLOAT():
            return BinaryOp(ctx.GREATER_EQUAL_OP_FLOAT().getText(), ctx.exp1(0).accept(self), ctx.exp1(1).accept(self))
        else:
            return ctx.exp1(0).accept(self)
</code></pre>
<p>CÃ¢y AST Ä‘Ã³ng má»™t vai trÃ² quan trá»ng trong láº­p trÃ¬nh, vá»›i Ä‘áº·c Ä‘iá»ƒm biá»ƒu diá»…n cáº¥u trÃºc ngá»¯ nghÄ©a cá»§a mÃ£ nguá»“n, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng AST trong cÃ¡c viá»‡c sau:</p>
<ol>
<li>PhÃ¢n tÃ­ch ngá»¯ nghÄ©a cá»§a ngÃ´n ngá»¯ (<code>semantic analysis</code>): vÃ­ dá»¥ khai bÃ¡o sai kiá»ƒu dá»¯ liá»‡u, tÃ¡i khai bÃ¡o láº¡i biáº¿n trong 1 pháº¡m vi,... Ä‘Ã¢y lÃ  nhá»¯ng kiá»ƒm tra phá»©c táº¡p hÆ¡n kiá»ƒm tra ngá»¯ phÃ¡p.</li>
<li>Sinh code (<code>code generation</code>): AST Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ sinh ra mÃ£ nguá»“n Ä‘Ã­ch, vÃ­ dá»¥ bytecode.</li>
<li>TÃ¡i cáº¥u trÃºc code: gá»£i Ã½ cÃ¡c cÃ¡ch code tá»‘t hÆ¡n, Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÃ¡c IDE.</li>
</ol>
<h3><a href="#intermediate-code-generation" aria-hidden="true" class="anchor" id="intermediate-code-generation"></a>Intermediate code generation</h3>
<p>ÄÃ¢y lÃ  má»™t bÆ°á»›c cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng, tuá»³ vÃ o thiáº¿t káº¿ cá»§a ngÃ´n ngá»¯.</p>
<p>Dá»±a vÃ o cÃ¢y AST, trÃ¬nh biÃªn dá»‹ch sinh ra mÃ£ trung gian, Ä‘Ã¢y lÃ  má»™t loáº¡i mÃ£ nguá»“n cÃ³ level tháº¥p hÆ¡n cÃ¡c ngÃ´n ngá»¯ báº­c cao nhÆ° Java, Go.</p>
<p>MÃ£ trung gian nhÆ° má»™t chiáº¿c cáº§u ná»‘i giá»¯a mÃ£ nguá»“n cá»§a ngÃ´n ngá»¯ báº­c cao vÃ  mÃ£ mÃ¡y, loáº¡i mÃ£ khÃ´ng phá»¥ thuá»™c vÃ o cáº¥u trÃºc váº­t lÃ½ cá»§a bá»™ xá»­ lÃ½ (<code>machine-independent</code>). ThÃ´ng thÆ°á»ng vá»›i kiá»ƒu thiáº¿t káº¿ nÃ y thÃ¬ sáº½ mang láº¡i lá»£i Ã­ch lÃ  tÃ¡ch biá»‡t sá»± phá»¥ thuá»™c cá»§a ngÃ´n ngá»¯ báº­c cao vÃ  mÃ¡y tÃ­nh váº­t lÃ½, má»i ngÆ°á»i cháº¯c háº³n cÅ©ng nghe Ä‘áº¿n cÃ¢u marketing ná»•i tiáº¿ng cá»§a Java: <code>write once run anywhere</code>.</p>
<p>Láº¥y Java lÃ m vÃ­ dá»¥ Ä‘á»ƒ phÃ¢n tÃ­ch thÃªm, trÃ¬nh biÃªn dá»‹ch táº¡o ra bytecode tá»« cÃ¡c file mÃ£ nguá»“n Java thÃ´ng thÆ°á»ng, JVM sáº½ nhÆ° má»™t trÃ¬nh thÃ´ng dá»‹ch (cÃ³ cáº£ <code>JIT</code>), thá»±c thi tá»«ng dÃ²ng bytecode nÃ y xuá»‘ng bá»™ xá»­ lÃ½, váº­y chÃºng ta cÅ©ng cÃ³ thá»ƒ coi JVM nhÆ° má»™t bá»™ <strong>xá»­ lÃ½ áº£o</strong> cho bytecode.</p>
<p>JVM cung cáº¥p má»™t táº­p cÃ¡c chá»‰ dáº«n Ä‘á»ƒ cÃ³ thá»ƒ thá»±c thi bytecode, nÃ³ lÃ  má»™t <code>stack machine</code>, tá»©c lÃ  Ä‘á»ƒ thá»±c thi cÃ¡c cÃ¢u lá»‡nh, nÃ³ thá»±c hiá»‡n cÃ¡c thao tÃ¡c push, pop vá»›i stack. MÃ¬nh sáº½ tÃ¬m hiá»ƒu kÄ© hÆ¡n á»Ÿ cÃ¡c bÃ i sau vá» pháº§n nÃ y.</p>
<h3><a href="#tá»•ng-káº¿t" aria-hidden="true" class="anchor" id="tá»•ng-káº¿t"></a>Tá»•ng káº¿t</h3>
<p>Trong bÃ i nÃ y, mÃ¬nh báº¯t Ä‘áº§u vá»›i nhá»¯ng thá»© cá»Ÿ báº£n nháº¥t cá»§a láº­p trÃ¬nh, biÃªn dá»‹ch, thÃ´ng dá»‹ch vÃ  lÃ m rÃµ má»™t sá»‘ giai Ä‘oáº¡n mÃ  má»™t trÃ¬nh biÃªn dá»‹ch xá»­ lÃ½ mÃ£ nguá»“n.</p>
<p>Kiáº¿n thá»©c ná»n táº£ng lÃ  thá»© cáº§n thiáº¿t Ä‘á»ƒ Ä‘i Ä‘Æ°á»£c con Ä‘Æ°á»ng dÃ i, mÃ¬nh nghÄ© váº­y.</p>
<p>LÃºc tÃ¬m hiá»ƒu láº¡i nhá»¯ng kiáº¿n thá»©c nÃ y Ä‘á»‘i vá»›i báº£n thÃ¢n váº«n cÃ²n nhiá»u chá»— mÆ¡ há»“, hy vá»ng Ä‘i tiáº¿p chuá»—i bÃ i viáº¿t nÃ£y sáº½ cÃ³ thÃªm cÆ¡ sá»Ÿ Ä‘á»ƒ cá»§ng cá»‘ kiáº¿n thá»©c cÅ©ng nhÆ° giáº£i thÃ­ch cÃ¡c thuáº­t ngá»¯, khÃ¡i niá»‡m má»™t cÃ¡ch rÃµ rÃ ng, rÃ nh máº¡ch hÆ¡n.</p>
<p>Viáº¿t cho ngÆ°á»i mÃ  thá»±c ra lÃ  viáº¿t cho mÃ¬nh.</p>
<h2><a href="#tham-kháº£o" aria-hidden="true" class="anchor" id="tham-kháº£o"></a>Tham kháº£o</h2>
<ol>
<li>Slides mÃ´n há»c NguyÃªn lÃ½ ngÃ´n ngá»¯ láº­p trÃ¬nh á»Ÿ trÆ°á»ng Äáº¡i há»c BÃ¡ch khoa Tp.Há»“ ChÃ­ Minh.</li>
<li><a href="https://medium.com/@saikadali/building-your-own-jvm-interpreter-from-scratch-86a085e225b1">https://medium.com/@saikadali/building-your-own-jvm-interpreter-from-scratch-86a085e225b1</a></li>
<li><a href="https://medium.com/@davewritescode/lets-have-fun-with-interpreters-and-bytecode-vms-chapter-3-f2392de2e269">https://medium.com/@davewritescode/lets-have-fun-with-interpreters-and-bytecode-vms-chapter-3-f2392de2e269</a></li>
<li><a href="https://www.quora.com/What-is-the-difference-between-a-compiler-and-an-interpreter/answers/7670223">https://www.quora.com/What-is-the-difference-between-a-compiler-and-an-interpreter/answers/7670223</a></li>
<li><a href="https://www.cse.iitm.ac.in/%7Emanas/docs/cs6843-hotspot.pdf">https://www.cse.iitm.ac.in/~manas/docs/cs6843-hotspot.pdf</a></li>
<li><a href="https://albertnetymk.github.io/2021/08/03/template_interpreter">https://albertnetymk.github.io/2021/08/03/template_interpreter</a></li>
<li><a href="https://github.com/cloudsec/ajvm">https://github.com/cloudsec/ajvm</a></li>
</ol>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/jvm.html'>jvm</a><a class='topic-tag' href='/tags/compiler.html'>compiler</a></div>
      <!-- <div class="copyright">
                Báº¡n Ä‘Æ°á»£c toÃ n quyá»n chia sáº», trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n, tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, thÃ¬ OK, cÅ©ng ko sao, sáº½ cÃ³ thiÃªn lÃ´i thay ta dÃ²m ngÃ³ nhÃ  ngÆ°Æ¡i. ğŸ˜ˆ
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>