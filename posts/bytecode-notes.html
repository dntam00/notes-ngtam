<html>

<head>
  <title>Bytecode (ghi ch√∫) | Linh tinh</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script src="../js/toc.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Linh tinh</span></a>
  </div>
  <div class="container has-toc navigation-box">
            <p><a href="/">&larr; Quay v·ªÅ trang ch·ªß</a></p>
        </div>
  <div class="container has-toc">
    <div class="table-of-contents">
        <div class="toc-title">M·ª•c l·ª•c</div>
        <ul class="toc-list">  <li><a href="#class-file" class="toc-link toc-level-2"><span class="toc-hash">#</span> .class file</a></li>
  <li><a href="#cu-trc-file-class" class="toc-link toc-level-2"><span class="toc-hash">#</span> C·∫•u tr√∫c file .class</a></li>
    <li><a href="#descriptor" class="toc-link toc-level-3"><span class="toc-hash">#</span> Descriptor</a></li>
    <li><a href="#tp-ch-dn" class="toc-link toc-level-3"><span class="toc-hash">#</span> T·∫≠p ch·ªâ d·∫´n</a></li>
  <li><a href="#thao-thc-bytecode" class="toc-link toc-level-2"><span class="toc-hash">#</span> Thao th√°c bytecode</a></li>
  <li><a href="#references" class="toc-link toc-level-2"><span class="toc-hash">#</span> References</a></li></ul>
    </div>
    <div class="main">
      <h1>Bytecode (ghi ch√∫)</h1>
      <p>Bytecode l√† m√£ trung gian ƒë∆∞·ª£c t·∫°o ra b·ªüi tr√¨nh bi√™n d·ªãch (compiler), ng√¥n ng·ªØ ngu·ªìn kh√¥ng nh·∫•t thi·∫øt l√† Java, n√≥ kh√¥ng ph·∫£i l√† m√£ m√°y (machine code) ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi JVM th√¥ng qua qu√° tr√¨nh th√¥ng d·ªãch (interpretation), Just-In-Time (JIT), ho·∫∑c Ahead-Of-Time (AOT).</p>
<p><img src="img/java-bytecode-jit.png" alt="java-bytecode-jit" /></p>
<h2><a href="#class-file" aria-hidden="true" class="anchor" id="class-file"></a>.class file</h2>
<p>Trong Java, bytecode ƒë∆∞·ª£c l∆∞u tr·ªØ trong c√°c file <code>.class</code>, c√≥ th·ªÉ ƒë∆∞·ª£c t·∫°o ra t·ª´ m√£ ngu·ªìn Java b·∫±ng tr√¨nh bi√™n d·ªãch th√¥ng qua l·ªánh <code>javac</code>.</p>
<p>V√≠ d·ª• c√≥ m·ªôt file <code>JavaByteCode.java</code> nh∆∞ sau:</p>
<pre><code class="language-java">public class JavaByteCode {

    public static void main(String[] args) {
    }

    public int add(int a, int b) {
        return a + b;
    }

    void testConstant() {
        String var = &quot;Hello&quot;;
    }
}
</code></pre>
<p>Ch·∫°y l·ªánh <code>javac JavaByteCode.java</code> s·∫Ω t·∫°o ra file <code>JavaByteCode.class</code>, ƒë√¢y l√† m·ªôt file ch·ª©a m√£ hex, n·∫øu ƒë·ªçc b·∫±ng hex editor s·∫Ω th·∫•y n·ªôi dung nh∆∞ sau:</p>
<p><img src="img/JavaByteCode-class-hex.png" alt="JavaByteCode-class-hex" /></p>
<p>T·∫•t nhi√™n ƒë√¢y kh√¥ng ph·∫£i d·∫°ng text c√≥ th·ªÉ ƒë·ªçc ƒë∆∞·ª£c r√µ r√†ng, ƒë·ªÉ xem c·∫•u tr√∫c v√† n·ªôi dung c·ªßa file n√†y, c·∫ßn m·ªôt c√¥ng c·ª• gi·∫£i m√£ v√† JDK cung c·∫•p s·∫µn l·ªánh <code>javap</code> ƒë·ªÉ l√†m vi·ªác n√†y.</p>
<p>L·ªánh <code>javap -c -verbose JavaByteCode.class</code> cho ra k·∫øt qu·∫£ nh∆∞ sau:</p>
<pre><code class="language-bash">Classfile /Users/dntam/Projects/java/leetcode/src/main/java/test/JavaByteCode.class
  Last modified Jul 13, 2025; size 402 bytes
  SHA-256 checksum e515c50ccb13397ae81db0bc1cdd28c13299c12fc757e200a0caae6c8c3c0131
  Compiled from &quot;JavaByteCode.java&quot;
public class test.JavaByteCode
  minor version: 0
  major version: 61
  flags: (0x0021) ACC_PUBLIC, ACC_SUPER
  this_class: #9                          // test/JavaByteCode
  super_class: #2                         // java/lang/Object
  interfaces: 0, fields: 0, methods: 4, attributes: 1
Constant pool:
   #1 = Methodref          #2.#3          // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Class              #4             // java/lang/Object
   #3 = NameAndType        #5:#6          // &quot;&lt;init&gt;&quot;:()V
   #4 = Utf8               java/lang/Object
   #5 = Utf8               &lt;init&gt;
   #6 = Utf8               ()V
   #7 = String             #8             // Hello
   #8 = Utf8               Hello
   #9 = Class              #10            // test/JavaByteCode
  #10 = Utf8               test/JavaByteCode
  #11 = Utf8               Code
  #12 = Utf8               LineNumberTable
  #13 = Utf8               main
  #14 = Utf8               ([Ljava/lang/String;)V
  #15 = Utf8               add
  #16 = Utf8               (II)I
  #17 = Utf8               testConstant
  #18 = Utf8               SourceFile
  #19 = Utf8               JavaByteCode.java
{
  public test.JavaByteCode();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 3: 0

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: (0x0009) ACC_PUBLIC, ACC_STATIC
    Code:
      stack=0, locals=1, args_size=1
         0: return
      LineNumberTable:
        line 6: 0

  public int add(int, int);
    descriptor: (II)I
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=3
         0: iload_1
         1: iload_2
         2: iadd
         3: ireturn
      LineNumberTable:
        line 9: 0

  void testConstant();
    descriptor: ()V
    flags: (0x0000)
    Code:
      stack=1, locals=2, args_size=1
         0: ldc           #7                  // String Hello
         2: astore_1
         3: return
      LineNumberTable:
        line 13: 0
        line 14: 3
}
SourceFile: &quot;JavaByteCode.java&quot;
</code></pre>
<h2><a href="#c·∫•u-tr√∫c-file-class" aria-hidden="true" class="anchor" id="c·∫•u-tr√∫c-file-class"></a>C·∫•u tr√∫c file .class</h2>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.4.6">C·∫•u tr√∫c file <code>.class</code></a> ƒë∆∞·ª£c chia ra c√°c ph·∫ßn ch√≠nh nh∆∞ sau:</p>
<table>
<thead>
<tr>
<th>Ph·∫ßn</th>
<th>M√¥ t·∫£</th>
<th>Tham kh·∫£o</th>
</tr>
</thead>
<tbody>
<tr>
<td>Class file structure</td>
<td>Metadata c·ªßa class: java version, constant_pool_count, access_flags, tham chi·∫øu index this class, super class, fields_count, method_count</td>
<td><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.1">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.1</a></td>
</tr>
<tr>
<td>Constant pool</td>
<td>B·∫£ng l∆∞u tr·ªØ c√°c k√≠ hi·ªáu (symbolic) cho class, c·ª• th·ªÉ l√† c√°c h·∫±ng s·ªë, tham chi·∫øu t√™n class, interface, method, variable,...</td>
<td><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.4">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.4</a></td>
</tr>
<tr>
<td>Fields</td>
<td>Bi·ªÉu di·ªÖn ƒë·ªãnh nghƒ©a c√°c bi·∫øn trong class: t√™n bi·∫øn, ki·ªÉu d·ªØ li·ªáu, access flag</td>
<td><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.5</a></td>
</tr>
<tr>
<td>Methods</td>
<td>Bi·ªÉu di·ªÖn ƒë·ªãnh nghƒ©a c√°c method trong class: t√™n h√†m, tham s·ªë, access flag, stack size, code th·ª±c thi,...</td>
<td><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.6">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.6</a></td>
</tr></tbody></table>
<h3><a href="#descriptor" aria-hidden="true" class="anchor" id="descriptor"></a>Descriptor</h3>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.3">Descriptor</a> l√† chu·ªói k√≠ t·ª± bi·ªÉu di·ªÖn <em>ki·ªÉu</em> c·ªßa:</p>
<ul>
<li>field: ki·ªÉu c·ªßa class, bi·∫øn instance, bi·∫øn c·ª•c b·ªô. V√≠ d·ª• bi·∫øn c√≥ ki·ªÉu <code>int</code> s·∫Ω ƒë∆∞·ª£c bi·ªÉu di·ªÖn l√† <code>I</code>, bi·∫øn c√≥ ki·ªÉu <code>String</code> s·∫Ω ƒë∆∞·ª£c bi·ªÉu di·ªÖn l√† <code>Ljava/lang/String;</code>.</li>
<li>method: ki·ªÉu c·ªßa h√†m, ki·ªÉu tham s·ªë, ki·ªÉu tr·∫£ v·ªÅ. V√≠ d·ª• h√†m main ƒë∆∞·ª£c bi·ªÉu di·ªÖn <code>([Ljava/lang/String;)V</code>, trong ƒë√≥:
<ul>
<li><code>[</code> l√† m·∫£ng, <code>L</code> l√† class (ki·ªÉu object), <code>I</code> l√† ki·ªÉu int, <code>V</code> l√† ki·ªÉu void.</li>
<li><code>([Ljava/lang/String;)V</code> c√≥ nghƒ©a l√† h√†m nh·∫≠n v√†o m·ªôt m·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng ki·ªÉu String v√† kh√¥ng tr·∫£ v·ªÅ gi√° tr·ªã g√¨.</li>
</ul>
</li>
</ul>
<h3><a href="#t·∫≠p-ch·ªâ-d·∫´n" aria-hidden="true" class="anchor" id="t·∫≠p-ch·ªâ-d·∫´n"></a>T·∫≠p ch·ªâ d·∫´n</h3>
<p>L·∫•y tr∆∞·ªùng h·ª£p JVM c·∫ßn th√¥ng d·ªãch bytecode, JVM c√≥ th·ªÉ ƒë∆∞·ª£c xem l√† b·ªô x·ª≠ l√Ω ·∫£o (virtual processor) cho bytecode, ƒë·ªÉ hi·ªán th·ª±c ƒëi·ªÅu n√†y, JVM cung c·∫•p t·∫≠p h·ª£p c√°c ch·ªâ d·∫´n (<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">instruction set</a>) ƒë·ªÉ th·ª±c thi.</p>
<p>Nh√¨n v√†o ph·∫ßn <code>Code</code> ·ªü m·ªói method c·ªßa file <code>.class</code>, c√°c l·ªánh nh∆∞ <code>iload_1</code>, <code>iload_2</code>, <code>iadd</code>, <code>ireturn</code> l√† c√°c ch·ªâ d·∫´n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi JVM, v·ªõi m·ªói ch·ªâ d·∫´n JVM s·∫Ω th·ª±c thi m·ªôt h√†nh ƒë·ªông c·ª• th·ªÉ.</p>
<p>Nh·∫Øc l·∫°i JVM l√† m·ªôt stack machine, c√°c ch·ªâ d·∫´n s·∫Ω thao t√°c v·ªõi c√°c to√°n h·∫°ng tr√™n stack.</p>
<p>L·∫•y h√†m c·ªông 2 s·ªë ƒë·ªÉ ph√¢n t√≠ch:</p>
<pre><code class="language-java">public int add(int a, int b) {
        return a + b;
}
</code></pre>
<p>Bytecode t∆∞∆°ng ·ª©ng:</p>
<pre><code>  public int add(int, int);
    descriptor: (II)I
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=3
         0: iload_1
         1: iload_2
         2: iadd
         3: ireturn
      LineNumberTable:
        line 13: 0
</code></pre>
<ol>
<li><code>iload_1</code> v√† <code>iload_2</code> s·∫Ω l·∫•y gi√° tr·ªã c·ªßa bi·∫øn <code>a</code> v√† <code>b</code> t·ª´ stack, ƒë∆∞a v√†o stack.
<ul>
<li>stack: [a, b] -&gt; 2 ph·∫ßn t·ª≠.</li>
</ul>
</li>
<li><code>iadd</code> s·∫Ω l·∫•y 2 gi√° tr·ªã tr√™n stack, th·ª±c hi·ªán ph√©p c·ªông v√† ƒë∆∞a k·∫øt qu·∫£ l√™n stack.
<ul>
<li>stack: [a + b] -&gt; 1 ph·∫ßn t·ª≠.</li>
</ul>
</li>
<li><code>ireturn</code> s·∫Ω l·∫•y gi√° tr·ªã tr√™n stack v√† tr·∫£ v·ªÅ k·∫øt qu·∫£.</li>
</ol>
<p>Trong qu√° tr√¨nh th·ª±c thi 3 b∆∞·ªõc ·ªü tr√™n, s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ t·ªëi ƒëa tr√™n stack l√† 2, ƒëi·ªÅu ƒë·∫∑c bi·ªát l√† tr√¨nh bi√™n d·ªãch t√≠nh to√°n ƒë∆∞·ª£c s·ªë n√†y d·ª±a tr√™n code v√† ghi v√†o metadata c·ªßa h√†m.</p>
<p>ƒêo·∫°n bytecode ·ªü tr√™n ch·ªâ c√≥ nh·ªØng l·ªánh c∆° b·∫£n, JVM cung c·∫•p <a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">h∆°n 200 l·ªánh</a> kh√°c nhau ƒë·ªÉ th·ª±c hi·ªán c√°c ph√©p to√°n, thao t√°c v·ªõi stack, ƒëi·ªÅu khi·ªÉn lu·ªìng ch∆∞∆°ng tr√¨nh, thao t√°c v·ªõi m·∫£ng, ƒë·ªëi t∆∞·ª£ng, v.v.</p>
<h2><a href="#thao-th√°c-bytecode" aria-hidden="true" class="anchor" id="thao-th√°c-bytecode"></a>Thao th√°c bytecode</h2>
<p>M·ªôt khi n·∫Øm ƒë∆∞·ª£c c√°c th√¥ng tin v·ªÅ bytecode, c√≥ th·ªÉ s·ª≠ d·ª•ng th∆∞ vi·ªán <a href="https://github.com/Guardsquare/proguard-core">proguard-core</a> ƒë·ªÉ th·ª≠ t·∫°o ra m·ªôt file class v√† ch·∫°y b·∫±ng l·ªánh <code>java</code>.</p>
<p>Th·ª≠ t·∫°o m·ªôt <a href="https://github.com/dntam00/java-notes/blob/6eb0744c87edb4b2c5873fad03ec0af1503bd847/src/main/java/bytecode/JavaByteCodeManipulation.java#L18">h√†m c·ªông 2 s·ªë v√† in ra k·∫øt qu·∫£</a> &lt;- ƒë∆∞·ªùng d·∫´n source code:</p>
<pre><code class="language-java">package bytecode;

public class HelloWorld {
    public static void main(String[] var0) {
        System.out.println(&quot;Hello, world!&quot;);
        System.out.println(&quot;Sum: &quot; + sum(5, 3));
    }

    public static int sum(int var0, int var1) {
        return var0 + var1;
    }
}
</code></pre>
<p>Sau khi c√≥ file <code>.class</code>, c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªánh <code>java</code> ƒë·ªÉ ch·∫°y v√† xem k·∫øt qu·∫£:</p>
<p><img src="img/java-bytecode-manipulation.png" alt="manipulation" /></p>
<h2><a href="#references" aria-hidden="true" class="anchor" id="references"></a>References</h2>
<ul>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html</a></li>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></li>
<li><a href="https://blogs.oracle.com/javamagazine/post/mastering-the-mechanics-of-java-method-invocation">https://blogs.oracle.com/javamagazine/post/mastering-the-mechanics-of-java-method-invocation</a></li>
<li><a href="https://blogs.oracle.com/javamagazine/category/jm-jvm-internals">https://blogs.oracle.com/javamagazine/category/jm-jvm-internals</a></li>
</ul>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/jvm.html'>jvm</a><a class='topic-tag' href='/tags/compiler.html'>compiler</a><a class='topic-tag' href='/tags/java.html'>java</a></div>
      <!-- <div class="copyright">
                B·∫°n ƒë∆∞·ª£c to√†n quy·ªÅn chia s·∫ª, tr√≠ch d·∫´n ho·∫∑c copy, post l·∫°i, nh∆∞ng vui l√≤ng ghi r√µ ngu·ªìn, t√°c gi·∫£ v√† kh√¥ng l√†m thay ƒë·ªïi n·ªôi dung b√†i vi·∫øt. N·∫øu kh√¥ng l√†m v·∫≠y, th√¨ OK, c≈©ng ko sao, s·∫Ω c√≥ thi√™n l√¥i thay ta d√≤m ng√≥ nh√† ng∆∞∆°i. üòà
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>