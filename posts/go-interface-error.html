<html>

<head>
  <title>Error checking in Golang  | Linh tinh</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script src="../js/toc.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Linh tinh</span></a>
  </div>
  <div class="container has-toc navigation-box">
            <p><a href="/">&larr; Quay v·ªÅ trang ch·ªß</a></p>
        </div>
  <div class="container has-toc">
    <div class="table-of-contents">
        <div class="toc-title">M·ª•c l·ª•c</div>
        <ul class="toc-list">  <li><a href="#interface" class="toc-link toc-level-2"><span class="toc-hash">#</span> Interface</a></li>
  <li><a href="#custom-error-type" class="toc-link toc-level-2"><span class="toc-hash">#</span> Custom error type</a></li>
  <li><a href="#error-assignment" class="toc-link toc-level-2"><span class="toc-hash">#</span> Error assignment</a></li>
  <li><a href="#notes" class="toc-link toc-level-2"><span class="toc-hash">#</span> Notes</a></li></ul>
    </div>
    <div class="main">
      <h1>Error checking in Golang </h1>
      <p>Trong th·∫ø gi·ªõi c·ªßa ng√¥n ng·ªØ l·∫≠p tr√¨nh Golang, m·ªçi ng∆∞·ªùi c√≥ th·ªÉ b·∫Øt g·∫∑p vi·ªác s·ª≠ d·ª•ng <code>if else</code> ƒë·ªÉ ki·ªÉm tra l·ªói ·ªü m·ªçi n∆°i, ki·ªÉu nh∆∞ th·∫ø n√†y:</p>
<pre><code class="language-Go">if err != nil {
	return
}
// do next thing
</code></pre>
<p>Th∆∞·ªùng th√¨ <code>error</code> trong Go l√† interface, c√≥ bao gi·ªù m·ªçi ng∆∞·ªùi t·ª± h·ªèi khi n√†o th√¨ <code>err == nil</code>? C√≥ ph·∫£i ƒë∆°n gi·∫£n l√† gi√° tr·ªã c·ªßa bi·∫øn b·∫±ng <code>nil</code> th√¨ c√¢u l·ªánh ki·ªÉm tra ƒë√≥ s·∫Ω ƒë√∫ng? Th·ª±c ra m√¨nh c≈©ng m·∫∑c ƒë·ªãnh l√† v·∫≠y, cho t·ªõi m·ªôt ng√†y m√¨nh g·∫∑p bug :|</p>
<p>N·∫øu ch∆∞∆°ng tr√¨nh c·ªßa ch√∫ng ta ch·ªâ s·ª≠ d·ª•ng m·ªói <code>error interface</code> c·ªßa Go ƒë·ªÉ tr·∫£ v·ªÅ l·ªói th√¨ c√≥ th·ªÉ an t√¢m s·ª≠ d·ª•ng, tuy nhi√™n ƒë·ªëi v·ªõi c√°c ·ª©ng d·ª•ng ph·ª©c t·∫°p, ch√∫ng ta s·∫Ω c√≥ nhu c·∫ßu tu·ª≥ ch·ªânh m·ªôt ki·ªÉu m·ªõi ƒë·ªÉ c√≥ th·ªÉ l∆∞u tr·ªØ th√¥ng tin th√™m cho l·ªói v√≠ d·ª• <code>stack trace</code>, <code>cause</code>, <code>error type</code>,... v√† t·ª´ ƒë√¢y, v·∫•n ƒë·ªÅ s·∫Ω xu·∫•t hi·ªán n·∫øu ch√∫ng ta kh√¥ng th·ª±c s·ª± hi·ªÉu v·ªÅ interface trong Go.</p>
<h2><a href="#interface" aria-hidden="true" class="anchor" id="interface"></a>Interface</h2>
<p>Interface cho ph√©p l·∫≠p tr√¨nh vi√™n ƒë·ªãnh nghƒ©a m·ªôt t·∫≠p c√°c h√†m m√† b·∫•t c·ª© ki·ªÉu d·ªØ li·ªáu n√†o c≈©ng c√≥ th·ªÉ hi·ªán th·ª±c, m·ªôt th·ª±c th·ªÉ interface (instance) n·∫Øm gi·ªØ gi√° tr·ªã v√† ki·ªÉu d·ªØ li·ªáu c·ªßa m·ªôt bi·∫øn m√† n√≥ ƒëang tham chi·∫øu t·ªõi. Go ƒë·ªãnh nghƒ©a c·∫•u tr√∫c d·ªØ li·ªáu ƒë·ªÉ l∆∞u tr·ªØ m·ªôt th·ª±c th·ªÉ interface nh∆∞ sau:</p>
<pre><code class="language-Go">type iface struct {
	tab  *itab
	data unsafe.Pointer
}

type itab struct {
	inter *interfacetype
	_type *_type
	hash  uint32
	_     [4]byte
	fun   [1]uintptr
}
</code></pre>
<p><code>interfacetype</code> l√† ki·ªÉu c·ªßa interface, <code>_type</code> l√† ki·ªÉu c·ª• th·ªÉ (struct) m√† m·ªôt th·ª±c th·ªÉ interface ƒëang gi·ªØ gi√° tr·ªã.</p>
<h2><a href="#custom-error-type" aria-hidden="true" class="anchor" id="custom-error-type"></a>Custom error type</h2>
<p>Nh∆∞ m√¨nh ƒë√£ ƒë·ªÅ c·∫≠p ·ªü tr√™n, trong nhi·ªÅu tr∆∞·ªùng h·ª£p <code>error interface</code> kh√¥ng ph√π h·ª£p v·ªõi nh·ªØng y√™u c·∫ßu v·ªÅ nghi·ªáp v·ª• v√† kƒ© thu·∫≠t, l√∫c ƒë√≥, ch√∫ng ta th∆∞·ªùng ƒë·ªãnh nghƒ©a m·ªôt struct ƒë·ªÉ qu·∫£n l√Ω error v√† s·ª≠ d·ª•ng ch√∫ng trong su·ªët ch∆∞∆°ng tr√¨nh, v√≠ d·ª•:</p>
<pre><code class="language-Go">type AppError struct {
	code      int
	errorType string
	cause     error
}

func (err *AppError) Error() string {
	return fmt.Sprintf(&quot;code: %v, cause: %v&quot;, err.code, err.cause)
}
</code></pre>
<h2><a href="#error-assignment" aria-hidden="true" class="anchor" id="error-assignment"></a>Error assignment</h2>
<p>L√∫c n√†y, n·∫øu kh√¥ng c·∫ßn th·∫≠n, ch√∫ng ta c√≥ th·ªÉ khai b√°o m·ªôt s·ªë h√†m tr·∫£ v·ªÅ ki·ªÉu <code>*AppError</code> v√† s·ª≠ d·ª•ng interface <code>error</code> ƒë·ªÉ l∆∞u nh·ªØng gi√° tr·ªã n√†y, v√† t·ª´ ƒë√≥, bug s·∫Ω x·∫£y ra n·∫øu ch√∫ng ra ki·ªÉm tra error c√≥ <code>nil</code> hay kh√¥ng. ƒê∆∞·ª£c ƒë·ªÅ c·∫≠p ·ªü ph·∫ßn ƒë·∫ßu, c·∫•u tr√∫c d·ªØ li·ªáu ƒë∆∞·ª£c d√πng ƒë·ªÉ l∆∞u m·ªôt th·ª±c th·ªÉ interface g·ªìm 2 ph·∫ßn, gi√° tr·ªã v√† ki·ªÉu c·ªßa bi·∫øn. ƒê·ªÉ m·ªôt bi·∫øn interface b·∫±ng <code>nil</code> (ƒë∆∞·ª£c ki·ªÉm tra b·∫±ng ph√©p ki·ªÉm tra <code>==</code>) th√¨ c·∫£ 2 ph·∫ßn c·ªßa n√≥ ƒë·ªÅu ph·∫£i <code>nil</code>.</p>
<pre><code class="language-Go">func checkAssignError() {
	var err error
	err = getErr()
	if err == nil {
		println(&quot;nil&quot;)
	} else {
		println(&quot;not nil&quot;)
	}
}

func getErr() *AppError {
	return nil
}
</code></pre>
<p>D·ª±a v√†o ki·∫øn th·ª©c tr√™n, gi√° tr·ªã ƒë∆∞·ª£c in ra console s·∫Ω l√† <code>not nil</code>. Golang cung c·∫•p g√≥i <code>reflect</code> ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ l√†m vi·ªác v·ªõi nh·ªØng gi√° tr·ªã dynamic l√∫c ch·∫°y ch∆∞∆°ng tr√¨nh, ti·∫øp t·ª•c v·ªõi ƒëo·∫°n code ·ªü tr√™n, ch·∫°y 2 d√≤ng l·ªánh sau v·ªõi bi·∫øn <code>err</code>:</p>
<pre><code class="language-Go">fmt.Println(reflect.TypeOf(err))
fmt.Println(reflect.ValueOf(err).IsNil())

// *main.AppError
// true
</code></pre>
<p>Ki·ªÉu c·ªßa <code>error</code> kh√¥ng ph·∫£i <code>nil</code> m√† l√† ki·ªÉu struct <code>*AppError</code>.</p>
<h2><a href="#notes" aria-hidden="true" class="anchor" id="notes"></a>Notes</h2>
<p>V·ªõi ki·∫øn th·ª©c n√†y, b·∫°n c√≥ th·ªÉ thi·∫øt k·∫ø code x·ª≠ l√Ω l·ªói m·ªôt c√°ch nh·∫•t qu√°n, tr√°nh nh·ªØng l·ªói t√¨m ·∫©n v√† ti·∫øt ki·ªám th·ªùi gian debug, ƒë·∫∑c bi·ªát khi ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n s·ª≠ d·ª•ng c√°c th∆∞ vi·ªán th·ª© 3 v√† s·ª≠ d·ª•ng nhi·ªÅu high order function, trong Golang th√¨ m√¨nh g·∫∑p r·∫•t nhi·ªÅu th∆∞ vi·ªán code theo style HOC, v√≠ d·ª• <code>go breaker</code>, c√°c h√†m c·ªßa <code>go breaker</code> s·ª≠ d·ª•ng <code>error interface</code>, n·∫øu h√†m c·ªßa b·∫°n s·ª≠ d·ª•ng <code>custom error type</code> nh∆∞ <code>AppError</code> ·ªü tr√™n th√¨ ch·∫Øc ch·∫Øn c√¢u l·ªánh ki·ªÉm tra <code>err == nil</code> s·∫Ω sai. M·ªôt v√≠ d·ª•:</p>
<pre><code class="language-Go">func (cb *CircuitBreaker[T]) Execute(req func() (T, error)) (T, error) {}
</code></pre>
<p>ƒê·ªÉ s·ª≠ d·ª•ng h√†m n√†y, b·∫°n ph·∫£i truy·ªÅn v√†o m·ªôt h√†m c√≥ ch·ªØ k√Ω h√†m <code>func() (T, error)</code>, n·∫øu b·∫°n s·ª≠ d·ª•ng <code>AppError</code>, code v·∫´n bi√™n d·ªãch ƒë∆∞·ª£c do <code>AppError</code> l√† m·ªôt ki·ªÉu hi·ªán th·ª±c <code>error interface</code>, nh∆∞ng h√†nh vi c·ªßa code s·∫Ω kh√¥ng ƒë√∫ng nh∆∞ mong ƒë·ª£i.</p>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/go.html'>go</a><a class='topic-tag' href='/tags/coding.html'>coding</a></div>
      <!-- <div class="copyright">
                B·∫°n ƒë∆∞·ª£c to√†n quy·ªÅn chia s·∫ª, tr√≠ch d·∫´n ho·∫∑c copy, post l·∫°i, nh∆∞ng vui l√≤ng ghi r√µ ngu·ªìn, t√°c gi·∫£ v√† kh√¥ng l√†m thay ƒë·ªïi n·ªôi dung b√†i vi·∫øt. N·∫øu kh√¥ng l√†m v·∫≠y, th√¨ OK, c≈©ng ko sao, s·∫Ω c√≥ thi√™n l√¥i thay ta d√≤m ng√≥ nh√† ng∆∞∆°i. üòà
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>