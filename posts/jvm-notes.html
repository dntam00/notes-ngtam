<html>

<head>
  <title>JVM (ghi chÃº) | Tam's Blog</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Tam's Blog</span></a>
  </div>
  <div class="container">
    <div class="main">
      <p><a href="/">&lt;- Quay vá» trang chá»§</a></p>
      <h1>JVM (ghi chÃº)</h1>
      <p>Java virtual machine - JVM  - MÃ¡y áº£o Java, lÃ  mÃ¡y áº£o giÃºp mÃ¡y tÃ­nh thá»±c thi cÃ¡c chÆ°Æ¡ng trÃ¬nh viáº¿t báº±ng Java hoáº·c cÃ¡c ngÃ´n ngá»¯ khÃ¡c cÃ³ trÃ¬nh biÃªn dá»‹ch táº¡o ra bytecode. Viá»‡c táº¡o ra JVM giÃºp ngÃ´n ngá»¯ Java cÃ³ tÃ­nh linh Ä‘á»™ng, viáº¿t má»™t láº§n thá»±c thi á»Ÿ nhiá»u nÆ¡i (<code>Write Once, Run Anywhere</code>), cÅ©ng nhÆ° áº©n giáº¥u ráº¥t nhiá»u pháº§n thiáº¿t káº¿, hiá»‡n thá»±c phá»©c táº¡p liÃªn quan Ä‘áº¿n viá»‡c láº­p trÃ¬nh nhÆ° quáº£n lÃ½ bá»™ nhá»›, sá»± phá»¥ thuá»™c, tá»‘i Æ°u thá»±c thi,... Ä‘á»ƒ láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ táº­p trung nhiá»u hÆ¡n vÃ o viá»‡c phÃ¡t triá»ƒn á»©ng dá»¥ng.</p>
<h2><a href="#tá»•ng-quan" aria-hidden="true" class="anchor" id="tá»•ng-quan"></a>Tá»•ng quan</h2>
<p>Nhá»¯ng gÃ¬ ngÃ´n ngá»¯ Java cung cáº¥p cho láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ gÃ³i gá»n á»Ÿ high-level nhÆ° hÃ¬nh sau:</p>
<ul>
<li><code>JVM</code>: trÃ¬nh thá»±c thi bytecode, load class, quáº£n lÃ½ vÃ¹ng nhá»›,</li>
<li><code>JRE</code>: bao gá»“m <code>JVM</code>, cÃ¡c module thÆ° viá»‡n cá»‘t lÃµi cá»§a Java (Object, String, Thread, ClassLoader,...), cÃ¡c thÆ° viá»‡n tiá»‡n Ã­ch khÃ¡c nhÆ° log, sql, desktop vÃ  cÃ¡c thÆ° viá»‡n native Ä‘Æ°á»£c viáº¿t báº±ng C/C++.
<ul>
<li>Báº¯t Ä‘áº§u tá»« Java 9, <code>JRE</code> Ä‘Æ°á»£c xem nhÆ° lÃ  thÃ nh pháº§n luáº­n lÃ½ vÃ¬ ká»ƒ tá»« Java 9, Java ra máº¯t khÃ¡i niá»‡m module, Oracle khÃ´ng cung cáº¥p riÃªng ráº½ JRE ná»¯a mÃ  gá»£i Ã½ ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ tá»± build mÃ´i trÆ°á»ng runtime tuá»³ thuá»™c vÃ o á»©ng dá»¥ng báº±ng <code>jlink</code>.</li>
</ul>
</li>
<li><code>JDK</code>: bao gá»“m <code>JRE</code> vÃ  cÃ¡c cÃ´ng cá»¥ há»— trá»£ phÃ¡t triá»ƒn (javac Ä‘á»ƒ biÃªn dá»‹ch, java Ä‘á»ƒ cháº¡y, jar Ä‘á»ƒ Ä‘Ã³ng gÃ³i,...).</li>
</ul>
<p><img src="img/jvm-jre-jdk.png" alt="jvm-jre-jdk" /></p>
<p>Váº­y tá»« thÃ´ng tin trÃªn, náº¿u cáº§n thá»±c thi bytecode, chá»‰ cáº§n táº¡o mÃ´i trÆ°á»ng runtime lÃ  Ä‘á»§.</p>
<h2><a href="#jvm" aria-hidden="true" class="anchor" id="jvm"></a>JVM</h2>
<p>ThÃ nh pháº§n quan trá»ng báº­c nháº¥t trong Java. Nhá»¯ng viá»‡c nhÆ° quáº£n lÃ½ bá»™ nhá»›, thu dá»n rÃ¡c (garbage collector), tá»‘i Æ°u thá»±c thi bytecode Ä‘Æ°á»£c JVM hiá»‡n thá»±c thay cho láº­p trÃ¬nh viÃªn.</p>
<p><em><strong>CÃ³ thá»ƒ tháº¥y JVM Ä‘Æ°á»£c khÃ´ng?</strong></em></p>
<p>JVM lÃ  trÃ¬nh thá»±c thi chÆ°Æ¡ng trÃ¬nh viáº¿t báº±ng Java hoáº·c cÃ¡c ngÃ´n ngá»¯ khÃ¡c cÃ³ thá»ƒ biÃªn dá»‹ch ra bytecode, váº­y trÆ°á»›c tiÃªn nÃ³ pháº£i cháº¡y Ä‘Æ°á»£c trong mÃ¡y tÃ­nh, váº­y nÃ³ lÃ  1 process, cÃ³ thá»ƒ xem cÃ¡c process jvm trong mÃ¡y báº±ng lá»‡nh <code>jcmd -l</code> Ä‘Æ°á»£c cung cáº¥p bá»Ÿi JDK.</p>
<pre><code class="language-java">55784 jdk.jcmd/sun.tools.jcmd.JCmd -l
85065 org.lift.backend.BackendApplication
69932 com.intellij.idea.Main
</code></pre>
<p>TÃªn chÆ°Æ¡ng trÃ¬nh lÃ  tÃªn Ä‘áº§y Ä‘á»§ cá»§a class chá»©a hÃ m main.</p>
<p><em><strong>Váº­y bÃªn trong JVM cÃ³ nhá»¯ng thÃ nh pháº§n nÃ o?</strong></em></p>
<p><img src="img/jvm-architecture.png" alt="jvm-architecture" /></p>
<h3><a href="#class-loader-subsystem" aria-hidden="true" class="anchor" id="class-loader-subsystem"></a>Class loader subsystem</h3>
<p>ThÃ nh pháº§n chá»‹u trÃ¡ch nhiá»‡m Ä‘á»‹nh vá»‹, náº¡p (<code>loading</code>), liÃªn káº¿t (<code>linking</code>), khá»Ÿi táº¡o (<code>initialization</code>) cÃ¡c class vÃ o JVM.</p>
<ol>
<li>Náº¡p class: náº¡p class tá»« thÆ° viá»‡n core hoáº·c cÃ¡c file bytecode.</li>
<li>LiÃªn káº¿t: kiá»ƒm tra tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a cÃ¡c file class, cáº¥p phÃ¡t vÃ¹ng nhá»› cho cÃ¡c biáº¿n, khá»Ÿi táº¡o giÃ¡ trá»‹ máº·c Ä‘á»‹nh.</li>
<li>Khá»Ÿi táº¡o: cháº¡y cÃ¡c Ä‘oáº¡n code khá»Ÿi táº¡o trong class (<code>static { ... }</code>).</li>
</ol>
<p>CÃ³ 3 loáº¡i <code>class loader</code> Ä‘Æ°á»£c cung cáº¥p bá»Ÿi JVM, má»—i loáº¡i hoáº¡t Ä‘á»™ng vá»›i cÃ¡c Ä‘á»‘i tÆ°á»£ng khÃ¡c nhau.</p>
<ul>
<li><code>Bootstrap classLoader</code>: loader duy nháº¥t Ä‘Æ°á»£c hiá»‡n thá»±c báº±ng native code thay vÃ¬ Java code, chá»‹u trÃ¡ch nhiá»‡m load cÃ¡c class cáº§n thiáº¿t Ä‘Æ°á»£c yÃªu cáº§u bá»Ÿi JVM, vÃ­ dá»¥ <code>java.base</code>.</li>
<li><code>Platform Classâ€¯Loader</code>: load cÃ¡c Java SE modules (<code>Java Platform, Standard Edition java.sql,...</code>), customs module Ä‘Æ°á»£c cung cáº¥p bá»Ÿi láº­p trÃ¬nh viÃªn.
<ul>
<li>[HÆ°á»›ng dáº«n <a href="https://stackoverflow.com/questions/76699669/which-exact-classes-are-loaded-by-platform-classloader">phÃ¢n loáº¡i module</a>]</li>
</ul>
</li>
<li><code>Application classLoader</code>: load cÃ¡c class trong Ä‘Æ°á»ng dáº«n classpath cá»§a á»©ng dá»¥ng (<code>-cp</code> hay biáº¿n mÃ´i trÆ°á»ng <code>CLASSPATH</code>).</li>
</ul>
<p>Ba loáº¡i loader nÃ y káº¿ thá»«a nhau, theo thá»© tá»± cha - con lÃ  <code>Bootstrap</code> &gt; <code>Extension</code> &gt; <code>Application</code>, ngoÃ i ra láº­p trÃ¬nh viÃªn cÃ³ thá»ƒ tá»± hiá»‡n thá»±c cÃ¡c lá»›p loader vÃ  sá»­ dá»¥ng.</p>
<h4><a href="#nguyÃªn-táº¯c" aria-hidden="true" class="anchor" id="nguyÃªn-táº¯c"></a>NguyÃªn táº¯c</h4>
<ol>
<li>NguyÃªn táº¯c uá»· thÃ¡c (parent delegation principle): JVM sá»­ dá»¥ng nguyÃªn lÃ½ uá»· quyá»n cho class cha khi load class, tá»©c lÃ  khi cÃ³ yÃªu cáº§u, <code>load loader</code> Ä‘áº©y yÃªu cáº§u lÃªn cho lá»›p cha cá»§a nÃ³ trÆ°á»›c, náº¿u khÃ´ng tÃ¬m tháº¥y thÃ¬ nÃ³ sáº½ xá»­ lÃ½ yÃªu cáº§u. NguyÃªn lÃ½ lÃ m viá»‡c nÃ y phÃ¹ há»£p vá»›i viá»‡c chia trÃ¡ch nhiá»‡m cho tá»«ng loáº¡i <code>class loader</code>, vÃ­ dá»¥ Ä‘á»‘i vá»›i nhá»¯ng class core cá»§a Java, chá»‰ cÃ³ <code>Bootstrap classLoader</code> má»›i cÃ³ quyá»n load, loáº¡i trá»« kháº£ nÄƒng láº­p trÃ¬nh viÃªn táº¡o cÃ¡c class trÃ¹ng tÃªn vá»›i thÆ° viá»‡n core vÃ  thay Ä‘á»•i hÃ nh vi, tÃ³m láº¡i lÃ  tÄƒng tÃ­nh báº£o máº­t, trÃ¡nh láº·p láº¡i cÃ´ng viá»‡c cá»§a nhau.</li>
</ol>
<pre><code class="language-java">// TrÃ­ch dáº«n hÃ m ClassLoader#loadClass.
protected Class&lt;?&gt; loadClass(String name, boolean resolve)
        throws ClassNotFoundException
    {
        try {
            if (parent != null) {
                c = parent.loadClass(name, false);
            } else {
                c = findBootstrapClassOrNull(name);
            }
        } catch (ClassNotFoundException e) {
            // ClassNotFoundException thrown if class not found
            // from the non-null parent class loader
        }
    }
</code></pre>
<ol start="2">
<li>
<p>NguyÃªn táº¯c hiá»ƒn thá»‹ (visibility principle): chá»‰ cung cáº¥p kháº£ nÄƒng hiá»ƒn thá»‹ cho trÃ¬nh náº¡p cá»§a class con Ä‘á»ƒ xem táº¥t cáº£ cÃ¡c class Ä‘Æ°á»£c táº£i bá»Ÿi má»™t parent class, chá»© khÃ´ng pháº£i ngÆ°á»£c láº¡i.</p>
</li>
<li>
<p>NguyÃªn táº¯c duy nháº¥t (uniqueness principle): má»—i class sáº½ chá»‰ Ä‘Æ°á»£c táº£i má»™t láº§n.</p>
</li>
<li>
<p>NguyÃªn táº¯c lÆ°á»i (lazy loading principle): class Ä‘Æ°á»£c náº¡p theo yÃªu cáº§u sá»­ dá»¥ng thay vÃ¬ Ä‘Æ°á»£c náº¡p khi JVM khá»Ÿi táº¡o.</p>
</li>
</ol>
<h4><a href="#code" aria-hidden="true" class="anchor" id="code"></a>Code</h4>
<ol>
<li>
<p>[VÃ­ dá»¥ cÃ¡ch hiá»‡n thá»±c <a href="https://github.com/dntam00/custom-classloader/blob/main/src/main/java/club/shengsheng/MyClassLoader.java">custom class loader</a>].</p>
</li>
<li>
<p>[VÃ­ dá»¥ cÃ¡ch xem <a href="https://github.com/dntam00/java-notes/blob/main/src/main/java/loader/Loader.java">class loader cá»§a má»™t class cá»¥ thá»ƒ</a>].</p>
</li>
</ol>
<pre><code class="language-java">public static void main(String[] args) {
    System.out.println(&quot;Classloader of ArrayList:&quot;
                                + ArrayList.class.getClassLoader());
    System.out.println(&quot;Classloader of DriverManager:&quot;
                                + DriverManager.class.getClassLoader());
    System.out.println(&quot;Classloader of Loader:&quot;
                                   + Loader.class.getClassLoader());
}
</code></pre>
<p>Cháº¡y mÃ£ nguá»“n (2) Ä‘Æ°á»£c káº¿t quáº£:</p>
<ol>
<li><code>ArrayList</code> thuá»™c thÆ° viá»‡n core nÃªn Ä‘Æ°á»£c load bá»Ÿi <code>Bootstrap</code>, loader nÃ y Ä‘Æ°á»£c viáº¿t báº±ng native code nÃªn lÃºc in ra sáº½ tháº¥y <code>null</code>.</li>
<li><code>DriverManager</code> thuá»™c module <code>java.sql</code> vÃ  Ä‘Æ°á»£c load bá»Ÿi <code>Platform loader</code>.</li>
<li><code>Loader</code> lÃ  má»™t class bÃ¬nh thÆ°á»ng vÃ  Ä‘Æ°á»£c load bá»Ÿi <code>AppClass loader</code>.</li>
</ol>
<p><img src="img/class-loader-result.png" alt="clas-loader-result" /></p>
<h3><a href="#runtime-data-area" aria-hidden="true" class="anchor" id="runtime-data-area"></a>Runtime data area</h3>
<p><img src="img/java-memory-architecture.png" alt="java-memory-architecture" /></p>
<p>JVM chia bá»™ nhá»› thÃ nh nhiá»u vÃ¹ng dá»¯ liá»‡u Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c Ä‘á»‘i tÆ°á»£ng khÃ¡c nhau:</p>
<ol>
<li>
<p><code>Method area</code>: khÃ¡i niá»‡m luáº­n lÃ½, HotSpot JVM hiá»‡n thá»±c pháº§n nÃ y vá»›i tÃªn gá»i <code>Metaspace</code> sá»­ dá»¥ng <strong>native memory</strong> cá»§a há»‡ Ä‘iá»u hÃ nh (trÆ°á»›c Java 9 gá»i lÃ  <code>PermGen</code>, sá»­ dá»¥ng heap), lÆ°u trá»¯ cÃ¡c thÃ´ng tin:</p>
<ul>
<li>Class metadata.</li>
<li>Runtime constant pool.</li>
<li>Bytecode cá»§a hÃ m.</li>
<li>Biáº¿n static: giÃ¡ trá»‹ cá»§a kiá»ƒu dá»¯ liá»‡u primitive hoáº·c giÃ¡ trá»‹ tham chiáº¿u.</li>
</ul>
</li>
<li>
<p><code>Stack</code>: JVM sá»­ dá»¥ng stack (cáº¥u trÃºc LIFO) Ä‘á»ƒ quáº£n lÃ½ viá»‡c gá»i hÃ m:</p>
<ul>
<li>
<p>CÆ¡ cháº¿:</p>
<ul>
<li>Gá»i hÃ m -&gt; táº¡o ra frame vÃ  push lÃªn stack.</li>
<li>Thá»±c thi xong hÃ m -&gt; pop frame ra khá»i stack.</li>
</ul>
</li>
<li>
<p>Frame chá»©a dá»¯ liá»‡u vá» hÃ m Ä‘ang Ä‘Æ°á»£c thá»±c thi, bao gá»“m má»™t sá»‘ thÃ´ng tin sau:</p>
<ul>
<li><code>Máº£ng biáº¿n cá»¥c bá»™ vÃ  tham sá»‘</code>: truy xuáº¥t theo index, náº¿u lÃ  hÃ m instane thÃ¬ biáº¿n <code>this</code> Ä‘Æ°á»£c Ä‘Ã¡nh index 0, cÃ¡c index 1 trá»Ÿ Ä‘i Ä‘Æ°á»£c dÃ nh cho tham sá»‘ vÃ  biáº¿n cá»¥c bá»™.
<ul>
<li>CÃ¡c kiá»ƒu dá»¯ liá»‡u nhÆ° <code>int</code>, <code>float</code>, <code>reference</code> chiáº¿m 1 slot index.</li>
<li>CÃ¡c kiá»ƒu dá»¯ liá»‡u <code>long</code>, <code>double</code> chiáº¿m 2 slot index.</li>
</ul>
</li>
</ul>
<p><em><strong>-&gt; Xem bytecode sáº½ tháº¥y rÃµ.</strong></em></p>
<ul>
<li>
<p><code>Stack toÃ¡n háº¡ng</code>: vá» máº·t cáº¥u trÃºc dá»¯ liá»‡u thÃ¬ giá»‘ng vá»›i stack Ä‘á»ƒ chá»©a frame. JVM lÃ  má»™t stack machine, nÃ³ xá»­ lÃ½ cÃ¡c cÃ¢u lá»‡nh báº±ng cÃ¡ch thao tÃ¡c vá»›i dá»¯ liá»‡u trÃªn stack:</p>
<ul>
<li>VÃ­ dá»¥: á»Ÿ stack Ä‘ang cÃ³ 2 sá»‘ 1 vÃ  2, khi thá»±c thi chá»‰ dáº«n <code>iadd</code>, JVM sáº½ láº¥y 2 pháº§n tá»­ á»Ÿ trÃªn stack vÃ  cá»™ng láº¡i vá»›i nhau (bá»Ÿi cpu), sau Ä‘Ã³ Ä‘áº©y láº¡i káº¿t quáº£ vÃ o stack. VÃ­ dá»¥ vá»›i phÃ©p cá»™ng <code>1 + 2</code>:
<ul>
<li>Bytecode: <code>iconst_1 â†’ iconst_2 â†’ iadd â†’ istore_1</code></li>
<li>Stack toÃ¡n háº¡ng: <code>[] â†’ [1] â†’ [1,2] â†’ [3]</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>LiÃªn káº¿t Ä‘á»™ng</code>:  Tham chiáº¿u cÃ¡c háº±ng sá»‘ Ä‘áº¿n Ä‘á»‹a chá»‰ vÃ¹ng nhá»› vá»¥ thá»ƒ, vÃ­ dá»¥ trong hÃ m cÃ³ sá»­ dá»¥ng cÃ¡c háº±ng string vÃ  gÃ¡n vÃ o biáº¿n (<code>String var = &quot;hello&quot;</code>), thÃ¬ stack frame cáº§n lÆ°u tham chiáº¿u nÃ y.</p>
</li>
<li>
<p><code>Äá»‹a chá»‰ tráº£ vá»</code>: lÆ°u Ä‘á»‹a chá»‰ cá»§a hÃ m gá»i Ä‘á»ƒ trÃ¬nh thÃ´ng dá»‹ch cÃ³ thá»ƒ thá»±c thi tiáº¿p sau khi káº¿t thÃºc gá»i hÃ m hiá»‡n táº¡i.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Heap</code>: JVM sá»­ dá»¥ng heap Ä‘á»ƒ lÆ°u object (class instances, array, String pool), Ä‘Ã¢y lÃ  vÃ¹ng dá»¯ liá»‡u cÃ³ sá»± hoáº¡t Ä‘á»™ng cá»§a GC vÃ  gÃ¢y ra nhiá»u váº¥n Ä‘á» Ä‘á»‘i vá»›i cÃ¡c á»©ng dá»¥ng phá»©c táº¡p nhÆ° trÃ n bá»™ nhá»›, GC cháº¡y gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a á»©ng dá»¥ng,...</p>
</li>
<li>
<p><code>PC registers</code>: lÆ°u trá»¯ Ä‘á»‹a chá»‰ cá»§a lá»‡nh Ä‘ang Ä‘Æ°á»£c thá»±c thi.</p>
</li>
<li>
<p><code>Native method stack</code>: lÆ°u trá»¯ thÃ´ng tin liÃªn quan Ä‘áº¿n viá»‡c sá»­ dá»¥ng cÃ¡c hÃ m native cá»§a cÃ¡c ngÃ´n ngá»¯ khÃ¡c nhÆ° C/C++.</p>
</li>
</ol>
<p>Tiáº¿p theo, hÃ¬nh sau thá»ƒ hiá»‡n má»‘i quan há»‡ cá»§a cÃ¡c vÃ¹ng nhá»› á»Ÿ trÃªn vá»›i thread, Ä‘Ã¢y lÃ  Ä‘iá»ƒm kiáº¿n thá»©c quan trá»ng cáº§n náº¯m khi láº­p trÃ¬nh vá»›i Java.</p>
<ul>
<li>Thread isolation: frame stack, pc registers, native method stacks.</li>
<li>Thread shared: heap, method area.</li>
</ul>
<p><img src="img/jvm-runtime-data-area-structure-thread-share.png" alt="jvm-runtime-data-area-structure-thread-share" /></p>
<p><em><strong>NÃ³i vá» Ä‘iá»ƒm nÃ y, cÃ³ vÃ i vÃ­ dá»¥ cá»¥ thá»ƒ cáº§n lÃ m rÃµ:</strong></em></p>
<ul>
<li>Biáº¿n cá»¥c bá»™ trong hÃ m:
<ul>
<li>Kiá»ƒu nguyÃªn thuá»·: á»Ÿ stack.</li>
<li>Kiá»ƒu object: tham chiáº¿u á»Ÿ stack, object á»Ÿ heap.</li>
</ul>
</li>
<li>Biáº¿n instance cá»§a object: cáº£ kiá»ƒu nguyÃªn thuá»· vÃ  object Ä‘á»u Ä‘Æ°á»£c lÆ°u á»Ÿ Heap.</li>
<li>String pool: á»Ÿ heap.</li>
</ul>
<h3><a href="#execute-engine" aria-hidden="true" class="anchor" id="execute-engine"></a>Execute engine</h3>
<h4><a href="#thá»±c-thi" aria-hidden="true" class="anchor" id="thá»±c-thi"></a>Thá»±c thi</h4>
<p>JVM cung cáº¥p cÃ¡c loáº¡i thá»±c thi sau:</p>
<ol>
<li>ThÃ´ng dá»‹ch: thá»±c thi tá»«ng dÃ²ng bytecode theo cÆ¡ cháº¿ stack.
<ul>
<li>JVM cÃ³ 1 táº­p chá»‰ dáº«n Ä‘á»ƒ thá»±c thi, khi khá»Ÿi táº¡o JVM, cÃ¡c mÃ£ mÃ¡y tÆ°Æ¡ng á»©ng sáº½ Ä‘Æ°á»£c load vÃ  lÆ°u trá»¯.</li>
</ul>
</li>
<li>JIT (Just in time): biÃªn dá»‹ch cÃ¡c Ä‘oáº¡n hot code (Ä‘Æ°á»£c gá»i nhiá»u) thÃ nh mÃ£ mÃ¡y, quÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n trong quÃ¡ trÃ¬nh thá»±c thi.</li>
<li>AOT (Ahead of time): biÃªn dá»‹ch sang mÃ£ mÃ¡y trÆ°á»›c khi thá»±c thi.</li>
</ol>
<p>Hiá»‡n táº¡i thÃ¬ Ä‘a sá»‘ JVM sá»­ dá»¥ng ThÃ´ng dá»‹ch vÃ  JIT.</p>
<h4><a href="#garbage-collector" aria-hidden="true" class="anchor" id="garbage-collector"></a>Garbage collector</h4>
<!-- Nhá»› nhá»¯ng ngÃ y Ä‘áº§u ngá»“i lá» má» cÃ i C++ Ä‘á»ƒ há»c mÃ´n láº­p trÃ¬nh á»Ÿ ÄH, rá»“i code cháº¡y hay bá»‹ segmentation fault hay tham chiáº¿u con trá» khÃ´ng há»£p lá»‡ :v, C++ hay C Ä‘á»ƒ pháº§n quáº£n lÃ½ vÃ¹ng nhá»› luÃ´n cho láº­p trÃ¬nh viÃªn, nghe cÃ³ váº» cÅ©ng nhiá»u quyá»n lá»±c nhÆ°ng náº¿u code khÃ´ng kÄ© thÃ¬ Ä‘Ãºng lÃ  Ä‘au khá»•. -->
<p>KhÃ¡c vá»›i C++ hay C, JVM quáº£n lÃ½ bá»™ nhá»› luÃ´n cho láº­p trÃ¬nh viÃªn, vÃ  nhÆ° má»™t láº½ tá»± nhiÃªn, cÃ³ cho thÃ¬ cÃ³ láº¥y, JVM cáº§n thu há»“i vÃ¹ng nhá»› khÃ´ng sá»­ dá»¥ng Ä‘á»ƒ tÃ¡i cáº¥p phÃ¡t, viá»‡c nÃ y Ä‘Æ°á»£c thá»±c thi bá»Ÿi trÃ¬nh dá»n rÃ¡c.</p>
<p>ThÃ´ng qua quÃ¡ trÃ¬nh phÃ¡t triá»ƒn cá»§a JVM, nhiá»u thuáº­t toÃ¡n Ä‘Ã£ Ä‘Æ°á»£c hiá»‡n thá»±c vá»›i má»¥c Ä‘Ã­ch chÃ­nh lÃ :</p>
<ul>
<li>Quáº£n lÃ½ vÃ¹ng nhá»› hiá»‡u quáº£, giáº£m phÃ¢n máº£nh.</li>
<li>TÄƒng hiá»‡u nÄƒng Ä‘á»ƒ giáº£m áº£nh hÆ°á»Ÿng Ä‘áº¿n á»©ng dá»¥ng.</li>
</ul>
<p>Má»™t sá»‘ thuáº­t toÃ¡n:</p>
<ul>
<li>Serial garbage collector: single thread, hiá»‡u nÄƒng tháº¥p.</li>
<li>Parallel garbage collector:  multi thread, hiá»‡u nÄƒng cao.</li>
<li>Concurrent Mark-Sweep (CMS): khÃ´ng cÃ²n Ä‘Æ°á»£c dÃ¹ng ká»ƒ tá»« JDK 14.</li>
<li>Garbage-First (G1 GC): máº·c Ä‘á»‹nh ká»ƒ tá»« JDK 9.</li>
<li>The Z Garbage Collector (ZGC): Ä‘Æ°á»£c há»— trá»£ tá»« JDK 15.</li>
</ul>
<h2><a href="#phá»¥-lá»¥c" aria-hidden="true" class="anchor" id="phá»¥-lá»¥c"></a>Phá»¥ lá»¥c</h2>
<p>Äá»ƒ báº¯t Ä‘áº§u tÃ¬m hiá»ƒu vá» JVM, cÃ³ thá»ƒ sá»­ dá»¥ng má»™t sá»‘ cÃ´ng cá»¥ sau:</p>
<ul>
<li>BiÃªn dá»‹ch mÃ£ nguá»“n Java thÃ nh bytecode báº±ng <code>javac</code>, sau Ä‘Ã³ Ä‘á»c bytecode báº±ng lá»‡nh <code>javap</code>, thuáº­t ngá»¯ gá»i lÃ   giáº£i mÃ£ (<code>disassembles</code>).</li>
<li>Lá»‡nh <code>jcmd</code>, sá»­ dá»¥ng <a href="github.com/cschaible/jcmd-ui">jcmd-ui</a> Ä‘á»ƒ xem thÃ´ng tin trá»±c quan hÆ¡n.</li>
</ul>
<h2><a href="#references" aria-hidden="true" class="anchor" id="references"></a>References</h2>
<ul>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se11/html/jvms-2.html#jvms-2.5">https://docs.oracle.com/javase/specs/jvms/se11/html/jvms-2.html#jvms-2.5</a></li>
<li><a href="https://stuefe.de/posts/metaspace/metaspace-architecture">https://stuefe.de/posts/metaspace/metaspace-architecture</a></li>
<li><a href="https://blog.jamesdbloom.com/JVMInternals.html">https://blog.jamesdbloom.com/JVMInternals.html</a></li>
<li><a href="https://stackoverflow.com/questions/40891433/understanding-metaspace-line-in-jvm-heap-printout/40899996#40899996">https://stackoverflow.com/questions/40891433/understanding-metaspace-line-in-jvm-heap-printout/40899996#40899996</a></li>
<li><a href="https://medium.com/azulsystems/using-jlink-to-build-java-runtimes-for-non-modular-applications-9568c5e70ef4">https://medium.com/azulsystems/using-jlink-to-build-java-runtimes-for-non-modular-applications-9568c5e70ef4</a></li>
</ul>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/jvm.html'>jvm</a><a class='topic-tag' href='/tags/compiler.html'>compiler</a><a class='topic-tag' href='/tags/java.html'>java</a></div>
      <!-- <div class="copyright">
                Báº¡n Ä‘Æ°á»£c toÃ n quyá»n chia sáº», trÃ­ch dáº«n hoáº·c copy, post láº¡i, nhÆ°ng vui lÃ²ng ghi rÃµ nguá»“n, tÃ¡c giáº£ vÃ  khÃ´ng lÃ m thay Ä‘á»•i ná»™i dung bÃ i viáº¿t. Náº¿u khÃ´ng lÃ m váº­y, thÃ¬ OK, cÅ©ng ko sao, sáº½ cÃ³ thiÃªn lÃ´i thay ta dÃ²m ngÃ³ nhÃ  ngÆ°Æ¡i. ğŸ˜ˆ
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>