<html>

<head>
  <title>Mapping 1-1 relationship in Hibernate ORM | Linh tinh</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script src="../js/toc.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Linh tinh</span></a>
  </div>
  <div class="container has-toc navigation-box">
            <p><a href="/">&larr; Quay v·ªÅ trang ch·ªß</a></p>
        </div>
  <div class="container has-toc">
    <div class="table-of-contents">
        <div class="toc-title">Table of Contents</div>
        <ul class="toc-list">  <li><a href="#context" class="toc-link toc-level-2"><span class="toc-hash">#</span> Context</a></li>
  <li><a href="#solution" class="toc-link toc-level-2"><span class="toc-hash">#</span> Solution</a></li>
  <li><a href="#use-case" class="toc-link toc-level-2"><span class="toc-hash">#</span> Use case</a></li>
  <li><a href="#appendix" class="toc-link toc-level-2"><span class="toc-hash">#</span> Appendix</a></li></ul>
    </div>
    <div class="main">
      <h1>Mapping 1-1 relationship in Hibernate ORM</h1>
      <hr />
<p><em><strong>Update notes:</strong></em></p>
<ul>
<li><code>30/08/2025</code>: add use case for 1-1 mapping in RDBMS.</li>
</ul>
<hr />
<h2 id="context">Context</h2>
<ul>
<li>Hibernate uses <code>@OneToOne</code> annotation to model 1-1 relationship in RDBMS. When we want to travel through entity
relationship, we model these relationships as bidirectional ones. But with <code>one-to-one</code> relationship, <code>hibernate</code> will
trigger additional query to fetch child entity if we map the relationship like others relationship.</li>
<li>In <strong>hibernate context</strong>, an object will be identified by <code>id</code> and <code>entity type</code> (aka class) [1].</li>
</ul>
<h2 id="solution">Solution</h2>
<p>When we model relationship as regular bidirectional <code>one-to-one</code> relationship like two entity below:</p>
<pre><code class="language-java">public class QuizEntity {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @OneToOne(fetch = LAZY, mappedBy = &quot;quiz&quot;, optional = false)
  private QuizResultEntity result;

  // other fields
}

public class QuizResultEntity {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @OneToOne(fetch = LAZY, optional = false)
  @JoinColumn(name = &quot;quiz_id&quot;)
  private QuizEntity quiz;

  // other fields
}
</code></pre>
<p>and fetch an entity of <code>QuizEntity type</code>, hibernate will trigger an additional query to check whether the associated QuizResultEntity object
existing or not to provide appropriate strategy to initialize relationship. If QuizResultEntity object exists, hibernate will create
a proxy, otherwise this field is set to <code>null</code>.</p>
<p>So if we add <code>optional = false</code> properties to <code>@OneToOne</code> annotation, will hibernate trigger additional query?</p>
<p>Unfortunately, based on [1], hibernate will still trigger additional query because the identifier of QuizResultEntity is <em>unknown</em>.</p>
<p>Query log:</p>
<pre><code class="language-sql">select q1_0.id from quiz q1_0 where q1_0.id=?
select q1_0.id,q1_0.quiz_id from quiz_result q1_0 where q1_0.quiz_id=?
</code></pre>
<p>-&gt; Use <code>@OneToOne</code> mapping with <code>@MapIds</code> at <code>QuizResultEntity</code> side can solve this problem. This will work because at <code>QuizEntity</code> side, hibernate knows the <code>ID</code> of associated <code>QuizResult</code> entity when it queries data.</p>
<pre><code class="language-java">public class QuizResultEntity {

  @Id
  // Note: we don't use auto generate strategy here.
  // @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @OneToOne(fetch = LAZY)
  @MapsId
  @JoinColumn(name = &quot;quiz_id&quot;)
  private QuizEntity quiz;

  // other fields
}
</code></pre>
<p>Query log:</p>
<pre><code class="language-sql">select q1_0.id from quiz q1_0 where q1_0.id=?
</code></pre>
<h2 id="use-case">Use case</h2>
<p>With these complex mappings, why on earth would you want to use them? Of course, it does not exist for fun. There are many cases in which one-to-one mappings are useful.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Partition_(database)#Vertical_partitioning">Vertical partition</a>: when an entity has many fields, we can split it into multiple tables based on query pattern to improve performance. For example, we have a <code>User</code> entity with many fields, we can split it into <code>User</code> and <code>UserProfile</code> entities. The <code>UserProfile</code> entity will have a 1-1 relationship with the <code>User</code> entity.
<ul>
<li>The <code>user_id</code> will be the mapping key.</li>
<li>These tables may reside in separate physical databases.</li>
</ul>
</li>
<li>Avoid <code>NULLs</code> and subtype discrimination: when an entity has multiple subtypes, for example, we have a <code>Product</code> entity with subtypes <code>Software_Product</code> and <code>Hardware_Product</code>, we can use 1-1 mapping to store the common fields in the <code>Product</code> table and the subtype-specific fields in separate tables.</li>
</ul>
<h2 id="appendix">Appendix</h2>
<p>Example source code: <a href="https://github.com/dntam00/learning-spring/tree/master/one-to-one">https://github.com/dntam00/learning-spring/tree/master/one-to-one</a></p>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/java.html'>java</a><a class='topic-tag' href='/tags/hibernate.html'>hibernate</a></div>
      <!-- <div class="copyright">
                B·∫°n ƒë∆∞·ª£c to√†n quy·ªÅn chia s·∫ª, tr√≠ch d·∫´n ho·∫∑c copy, post l·∫°i, nh∆∞ng vui l√≤ng ghi r√µ ngu·ªìn, t√°c gi·∫£ v√† kh√¥ng l√†m thay ƒë·ªïi n·ªôi dung b√†i vi·∫øt. N·∫øu kh√¥ng l√†m v·∫≠y, th√¨ OK, c≈©ng ko sao, s·∫Ω c√≥ thi√™n l√¥i thay ta d√≤m ng√≥ nh√† ng∆∞∆°i. üòà
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>