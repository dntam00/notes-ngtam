<html>

<head>
  <title>Application version in Go | Linh tinh</title>
  <meta charset="utf-8">
  <meta http-equiv="content-type" content="text/html;">
  <meta name=viewport content="initial-scale=1.0 maximum-scale=1.0">
  <meta property='og:image' content='https://melancholy.com/img/default.jpg'>
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
  <link rel="manifest" href="../manifest.json">
  <link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;subset=latin-ext,vietnamese"
    rel="stylesheet">
  <!-- <link href="../css/theme.css?t=" rel="stylesheet" type="text/css"> -->
  <link href="/css/theme.css" rel="stylesheet" type="text/css">
  <!-- <link href="/css/gruvbox-dark.css" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="../css/highlight/tomorrow.css">
  <link rel="stylesheet" href="../css/fontello.css">
  <link rel="stylesheet" href="../emoji/css/emoji.dist.css">
  <link rel="stylesheet" href="../emoji/css/emojione.min.css">
  <link rel="stylesheet" href="../emoji/css/messenger.min.css">
  <link rel="stylesheet" href="../emoji/css/thinking.ext.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css"> -->
  <script src="../js/highlight.min.js"></script>
  <script src="../js/autosizing.js"></script>
  <script src="../js/fetch.js"></script>
  <script src="../js/toc.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.highlightAll();
  </script>
</head>

<body>
  <div class="header">
    <a href="/"><span class="avatar"></span><span class="header-link">Linh tinh</span></a>
  </div>
  <div class="container has-toc navigation-box">
            <p><a href="/">&larr; Quay v·ªÅ trang ch·ªß</a></p>
        </div>
  <div class="container has-toc">
    <div class="table-of-contents">
        <div class="toc-title">M·ª•c l·ª•c</div>
        <ul class="toc-list">  <li><a href="#git-tag-revision" class="toc-link toc-level-2"><span class="toc-hash">#</span> Git tag, revision</a></li>
  <li><a href="#go" class="toc-link toc-level-2"><span class="toc-hash">#</span> Go</a></li></ul>
    </div>
    <div class="main">
      <h1>Application version in Go</h1>
      <p>Hi·ªán nay, ch√∫ng ta c√≥ th·ªÉ th·∫•y CI/CD ƒë∆∞·ª£c √°p d·ª•ng ·ªü n∆°i, vi·ªác chu·∫©n ho√° c√°c qu√° tr√¨nh n√†y b·∫±ng c√°c c√¥ng c·ª• nh∆∞ Jenkins gi√∫p c√°c l·∫≠p tr√¨nh vi√™n gi·∫£m thi·ªÉu th·ªùi gian t√≠ch h·ª£p, tri·ªÉn khai ph·∫ßn m·ªÅm. Tuy nhi√™n, kh√¥ng ph·∫£i l√∫c n√†o nh·ªØng pipeline n√†y c≈©ng ch·∫°y ƒë√∫ng, team infra c√≥ th·ªÉ vi·∫øt script kh√¥ng c·∫©n th·∫≠n v√† m·ªôt ng√†y ƒë·∫πp tr·ªùi ·ª©ng d·ª•ng c·ªßa b·∫°n v·∫´n ch·∫°y v·ªõi code c≈© sau nhi·ªÅu l·∫ßn b·∫•m deploy tr√™n pipeline :). ƒê·ªÉ ƒë·∫£m b·∫£o an to√†n v√† ti·∫øt ki·ªám th·ªùi gian, c√≥ m·ªôt c√°ch m√† nhi·ªÅu ng∆∞·ªùi s·ª≠ d·ª•ng ƒë√≥ l√† hi·ªÉn th·ªã tag, commit, th·ªùi gian build code khi build source code.</p>
<h2 id="git-tag-revision">Git tag, revision</h2>
<p>ƒê·ªÉ l·∫•y ƒë∆∞·ª£c th√¥ng tin <code>tag</code>, <code>revision commit</code> c·ªßa source code v√† g√°n v√†o c√°c bi·∫øn m√¥i tr∆∞·ªùng c·ªßa m·ªôt bash session, ta c√≥ th·ªÉ d√πng c√°c c√¢u l·ªánh sau ƒë√¢y:</p>
<pre><code class="language-bash">export GitTags=$(git describe --tags)
export RevVersion=$(git rev-parse --short HEAD)
</code></pre>
<p>D√≤ng l·ªánh sau l·∫•y ƒë∆∞·ª£c th√¥ng tin th·ªùi gian build code:</p>
<pre><code class="language-bash">export BuildTime=$(date -u &quot;+%Y%m%d%I%M&quot;)
</code></pre>
<h2 id="go">Go</h2>
<p>Go cung c·∫•p flag <code>ldflags</code> ·ªü qu√° tr√¨nh build code ƒë·ªÉ c√≥ th·ªÉ truy·ªÅn nh·ªØng th√¥ng tin c·∫ßn thi·∫øt cho ·ª©ng d·ª•ng, tr∆∞·ªùng h·ª£p n√†y m√¨nh c·∫ßn truy·ªÅn <code>AppVersion</code>, c√¢u l·ªánh build nh∆∞ sau:</p>
<pre><code class="language-bash">go build -ldflags &quot;-X main.AppVersion=$GitTags.$RevVersion.$BuildTime&quot; -o bin/app cmd/app/main.go

</code></pre>
<p>·ªû trong code, b·∫°n ch·ªâ c·∫ßn khai b√°o bi·∫øn t√™n <code>AppVersion</code> l√† s·∫Ω nh·∫≠n ƒë∆∞·ª£c nh·ªØng th√¥ng tin n√†y:</p>
<pre><code class="language-go">var AppVersion string

func main() {
	fmt.Println(AppVersion)
}
</code></pre>
<p>M·ªçi b∆∞·ªõc ƒë√£ xong, khi n√†o b·∫•m n√∫t pipeline xong l√† l√™n kibana hay ƒë√¢u ƒë√≥ check log th√¥i :)</p>

      <div class='other-tags'><b>Tags:</b> <a class='topic-tag' href='/tags/go.html'>go</a><a class='topic-tag' href='/tags/git.html'>git</a></div>
      <!-- <div class="copyright">
                B·∫°n ƒë∆∞·ª£c to√†n quy·ªÅn chia s·∫ª, tr√≠ch d·∫´n ho·∫∑c copy, post l·∫°i, nh∆∞ng vui l√≤ng ghi r√µ ngu·ªìn, t√°c gi·∫£ v√† kh√¥ng l√†m thay ƒë·ªïi n·ªôi dung b√†i vi·∫øt. N·∫øu kh√¥ng l√†m v·∫≠y, th√¨ OK, c≈©ng ko sao, s·∫Ω c√≥ thi√™n l√¥i thay ta d√≤m ng√≥ nh√† ng∆∞∆°i. üòà
                </div> -->
    </div>
  </div>
  <div class="footer">
    <p>Created with <i class="em em-coffee"></i> <a href="http://github.com/huytd/ristretto-rs">ristretto.rs</a></p>
    <div class="social">
      <a target="_blank" href="https://github.com/dntam00"><i class="icon-github-squared"></i></a>
      <a target="_blank" href="https://www.linkedin.com/in/dang-ngoc-tam/"><i class="icon-linkedin-squared"></i></a>
    </div>
  </div>
  <script type="text/javascript" async=""
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            skipTags: ["script","noscript","style","textarea", "code"],
            ignoreClass: ["comment", "comment-list"]
          }
        });
  </script>
</body>

</html>